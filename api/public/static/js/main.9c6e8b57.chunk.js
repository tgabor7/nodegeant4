(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{224:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAh1BMVEX///8AAAD39/dXV1dra2tnZ2f6+vpubm5aWlphYWF1dXUjIyP8/Px8fHweHh5UVFRDQ0Pw8PA7Ozvf399LS0vU1NSdnZ0aGhrr6+vOzs4yMjLa2tqmpqasrKzAwMAoKCiKiooRERG7u7uPj48vLy96enqWlpYLCwtISEi+vr6hoaE3Nzc/Pz/54TKiAAAIzUlEQVR4nO2daVvqPBCGW8QNEVFAQFQo4HLE///7Xha7TyaTNplJeft8OtdpG+Y2bbM08yQImq3FT++yu5pJh+FM7y/hSW/SkbhR/zZM1JMOxoVGYVa7R+l4rGsRFjSSjsiyJkXAMHyXjsmqSjVY9X3zOFm/fW42q5PuM+rtdb1X97KoW0j5U7rXWfVy+jgW312gcc0gwDD8NKObvV7C5XDoFf/Dqy5bGeA9LzmBisLvt06kvPCDyDe54YOBhNdgZ4BcSmoYJ0M2FFiaW3SKXnyt5XsUfPpOwgGBZiIvHeIbBwOqHzzAlbYA9Ea9umBAwKUBDIKutoh79cUj7cXO9awDDIKxtpCV6tJ3BgKNSG32VlvMBr5Q/hEkdkqQ9jAWeCt4AKj405ek7NOkAvoMa/cAOuGAsygdAir6pVmti9drmxn30gDuz0jnY8CxRV6FwRSh3l1LD5hFJNTIPFfAk+Pw9cJfMnE7liLO9UVOMgVsnAZPEd4Opg11RUT5lh7vyWTjSxEJzXcyjt45i5wofDyYrwAjxL/pKfGGovRmRwCzk2p6xOh04pebuMmaK9BgQDPEY5sh3ZnBJ52gls8A8TitgY+Zjxpv1vPFaDSazWaPe3Us6eoglE/RtNMRtwHhrTtca6JwKFXfJUXUhb8/RTNr8YDfRG6l7pylUeGI0/2wHgcUnSrHep9ExJsg+Icdf5C7PwNd3zNFxP4Qr0HwgRxGJjwYpOtcp30yBHE/4rpTH6UOSN1IP3ogdDv3ddRRF+B3DeYRVUNitKAHOTo0LhPEw7Oq7pN25PBIQyMC4rFD/6O6VrSZoAJm+7TlaYrTkEw1SS56j9IBc4hR/sjfoFrVWEh+9zcBVCPGH3h68GUXMmxHmQFmEbNfFpMxp4JQ8Ck0Bcwh3pX/T0EogXZSlY8n5VrMPGQwof5DqitV+zpUrMXsUj6YUGwlXNXPXxnE6bEzmgomlHqTVv++l63F/GJMmLDPjXZSnQ+YyuksmJATK1W9L7QqRJDwixUsVt1pWwUiSBjxop1Uf14aRvTmLrUx8Q4iXntCaOfLAjSt5AmhHcAJVLQfhHYA4ZldLwjtfDlRTF37QOgU0AdCt4AeENoBVPekxQkd16A8oesaFCd0DyhMyAAoS8gBKErIAihJ+MoCKEjIBChHyAUoRqj85mUbUIrQDiAph1uGkBFQhpADsB/P+UoQstTgMP6HACEL4G/CwE/4zAH4FMoRcgGKEbIA7rIMzIQcgP2XHAMvIQvgNs/ASsgBeBVnJ0oQ2gHETUyuEh+B+H/grNrmAqaLSfkJrQB+4YCdzGpZdkKOGsy5LXATctTgVW69MzOhFcCIfouyE3IAXhVWrLMSsgAW7WY4Ca0ATvFV2SVATkIOQMBngY+QBfBXzeCc0ArgQAP4jTC4JmQBBD1nmAg/bQDeaQDx0YNjQhufl+50CXRw6hYToQVEXQ0GAWy8xkVYG3GpT4EUJqyJuCQsV5YmrIW4pSSxChHOvi0gvpAWnAu9adaZzKKqiDRAKcJ9weOaiERAKcJDMcn3n0qIT9SfkiE8Zbn+1kAkAwoRbophmiL+IoUXBLt9uiaMx2vps2SGaAAoQ5jmHW8rIQ6xwr0gzNCk3S46ohGgDGHGED4zNqAimgHKEOZKWyajAxriN1ayJ4SFXN6BEeIYK5lOGD//bgiLWf4miMaAChuomBB2GKpLWGqD6YjmgBKEgEdFlCDiGUBVvBwECKF6miaT8hhiJbMKAULQ0p2CWM2Ng5+wD4f/pUWs6FXBT6jyfUgRYfutqmYcOKGL1kJtm54sFIHStm+q/h4/IWKuhSBWBuQnRI2alYjVAfkJ8VX4CWL+ab2t8YPshJrdB0DEOoD8hDggiFgLkJ1Q7xGUZEnEpmyXtQDZCe+1hEXEmoDshNg+NyXEg6djtxZeoCKMZxasE9K8wZO83UV9QMXf1BkhMWMrMXiwYGfETPhAI9RYXBuJl1AxrnCKyEto4IRkzfWOl5DQViSy5ZnGS0h3sB++2toClpWQuo/E2BpewExIyku7Xdv1t2Ul1LYVu9Xcut0dJ6HG4L23drKnLSch0laMn50Z9HMSKtqK6OPdpbM0JyFYeT+unTQZCUttRXT/zrD3ACNhvq1wX3l/YiTM7L3Y46i8P8Hzsy4I410I2CrvT3yEh7aC58nLi4/w+uLNYm+TLj5CKbWELaH/aglbQv8FE0p6DNlWS9gS+q+WsCX0Xy1hS+i/8Lyn8yf0Zo+SGsLzLVrCJqglPFPCZM+qcyAE17WdP2EUHz1/QninVcl4zQUSTuOjLWETFEEIg/govLZAMl5zgYR38dGzJVzGR/+nhDJ7WFZWBcIpVp5/Agm38dFzuEvBNa0JIZwrKBmvseCl5S/xYZhQZMFBVXVABA2h4Nbq5pqACLv4MEy4kovXXLCHQeL9AxMusRJ9E5ysnVj4KLKSpbYeryBFDkviAKMgvJeM2UyK5P7EAmYDHw9drum1qxcYIHEQUXnEbiSDNpFqaXmSG65MpnOyqt6BVMn/vfgEpQtHBZ8YCamesnAVnwE3lwf9yIVNlzr8JG3sUXmKzRxIVyJFjySbed8odpCs6vQ9AvcITnKW5WJHj3AS91GD9DTUmWotF75e6mcwzHVZUCeS9J3rn3Az9OxLZIee6Ws1zhETnIOy5+qSIrceMv4baoL+yJ4ND5Fz6r559FodreHVFTnl35Hw56eSli8H7Z4OGh41Puohp4uibiDlT3ko6Fjs9+EXfg8/tjv87na5192AYroRlrwl8XdNI1XsrBBqvVkqWfQifZ9mqtxTsbLPhj+CGnHYe7+pgtLhqVYIjRA8JrKz07kXWoGAZ/Q+VRuEQlsmNVBbJSC0r1cDFWGzoP0zQBzgM4R9XYfde22189jYjEYDRPGwtbMdqpBo0/SLSDrOyiJPfpqYdXmknoFz0WisL883/RrOe84b1vovKyw7WBBnNnzQRcWvD/11I5qOp+daC2MWb6sL4tSPhIYrinXYf/6Tr8nVKFbTAAAAAElFTkSuQmCC"},23:function(e,t,a){},371:function(e,t,a){e.exports=a(754)},376:function(e,t,a){},548:function(e,t){},550:function(e,t){},560:function(e,t){},562:function(e,t){},587:function(e,t){},589:function(e,t){},590:function(e,t){},596:function(e,t){},598:function(e,t){},616:function(e,t){},618:function(e,t){},630:function(e,t){},633:function(e,t){},638:function(e,t){},640:function(e,t){},663:function(e,t){},754:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(35),i=a.n(o),s=(a(376),a(6)),l=a(12),c=a.n(l),u=a(15),h=a(2),d=a(5),m=a(4),p=a(10),f=a(11),g=(a(23),function(){function e(t,a,n){Object(h.a)(this,e),this.gl=n;var r=a.vertexShader,o=a.fragmentShader,i=n.createShader(n.VERTEX_SHADER),s=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(i,r),n.shaderSource(s,o),n.compileShader(i),n.getShaderParameter(i,n.COMPILE_STATUS))if(n.compileShader(s),n.getShaderParameter(s,n.COMPILE_STATUS)){this.program=n.createProgram(),n.attachShader(this.program,i),n.attachShader(this.program,s);for(var l=0;l<t.length;l++)n.bindAttribLocation(this.program,t[l][0],t[l][1]);n.linkProgram(this.program),n.getProgramParameter(this.program,n.LINK_STATUS)?(n.validateProgram(this.program),n.getProgramParameter(this.program,n.VALIDATE_STATUS)||console.error("ERROR validating program!",n.getProgramInfoLog(this.program))):console.error("ERROR linking program!",n.getProgramInfoLog(this.program))}else console.error("ERROR compiling fragment shader!",n.getShaderInfoLog(s));else console.error("ERROR compiling vertex shader!",n.getShaderInfoLog(i))}return Object(d.a)(e,[{key:"bind",value:function(){this.gl.useProgram(this.program)}},{key:"unBind",value:function(){this.gl.useProgram(null)}},{key:"setUniform",value:function(e,t){var a=this.gl.getUniformLocation(this.program,e);-1!=a&&this.gl.uniform1f(a,t)}},{key:"setUniform1i",value:function(e,t){var a=this.gl.getUniformLocation(this.program,e);-1!=a&&this.gl.uniform1i(a,t)}},{key:"setUniform3f",value:function(e,t,a,n){var r=this.gl.getUniformLocation(this.program,e);-1!=r&&this.gl.uniform3f(r,t,a,n)}},{key:"setUniform4fv",value:function(e,t){var a=this.gl.getUniformLocation(this.program,e);-1!=a&&this.gl.uniformMatrix4fv(a,!1,t)}}]),e}()),v=a(370),b=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;return Object(h.a)(this,a),(e=t.call(this,16))[0]=1,e[5]=1,e[10]=1,e[15]=1,e}return a}(Object(v.a)(Float64Array)),y=function(){function e(t,a,n,r){Object(h.a)(this,e),this.x=t,this.y=a,this.z=n,this.w=r}return Object(d.a)(e,[{key:"xyz",value:function(){return new E(this.x,this.y,this.z)}}]),e}(),E=function e(t,a,n){Object(h.a)(this,e),this.x=t,this.y=a,this.z=n},x=function e(t,a,n,r,o){Object(h.a)(this,e),this.x=t,this.y=a,this.d=n,this.p=r,this.a=o},w=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"scale",value:function(e,t){for(var a=new b,n=0;n<16;n++)a[n]=e[n];return a[0]=a[0]*t.x,a[1]=a[1]*t.x,a[2]=a[2]*t.x,a[4]=a[4]*t.y,a[5]=a[5]*t.y,a[6]=a[6]*t.y,a[8]=a[8]*t.z,a[9]=a[9]*t.z,a[10]=a[10]*t.z,a}},{key:"translate",value:function(e,t){for(var a=new b,n=0;n<16;n++)a[n]=e[n];return a[12]=e[0]*t.x+e[4]*t.y+e[8]*t.z+e[12],a[13]=e[1]*t.x+e[5]*t.y+e[9]*t.z+e[13],a[14]=e[2]*t.x+e[6]*t.y+e[10]*t.z+e[14],a[15]=e[3]*t.x+e[7]*t.y+e[11]*t.z+e[15],a}},{key:"normalize",value:function(e){var t=new E;t.x=e.x,t.y=e.y,t.z=e.z;var a=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return t.x/=a,t.y/=a,t.z/=a,t}},{key:"mulVectorDouble",value:function(e,t){var a=new E(0,0,0);return a.x=e.x,a.y=e.y,a.z=e.z,a.x*=t,a.y*=t,a.z*=t,a}},{key:"cross",value:function(e,t){var a=new E(0,0,0);return a.x=e.y*t.z-e.z*t.y,a.y=e.z*t.x-e.x*t.z,a.z=e.x*t.y-e.y*t.x,a}},{key:"lookAt",value:function(e,t,a){var n=new E(0,0,0),r=new E(0,0,0);n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n=this.normalize(n);var o=new E(0,0,0);o=this.cross(n,a),o=this.normalize(o),r=this.cross(o,n);var i=new b;return i[0]=o.x,i[1]=o.y,i[2]=o.z,i[4]=r.x,i[5]=r.y,i[6]=r.z,i[8]=-n.x,i[9]=-n.y,i[10]=-n.z,i=this.invert(i)}},{key:"invert",value:function(e){var t=new b,a=new b,n=0;a[0]=e[5]*e[10]*e[15]-e[5]*e[11]*e[14]-e[9]*e[6]*e[15]+e[9]*e[7]*e[14]+e[13]*e[6]*e[11]-e[13]*e[7]*e[10],a[4]=-e[4]*e[10]*e[15]+e[4]*e[11]*e[14]+e[8]*e[6]*e[15]-e[8]*e[7]*e[14]-e[12]*e[6]*e[11]+e[12]*e[7]*e[10],a[8]=e[4]*e[9]*e[15]-e[4]*e[11]*e[13]-e[8]*e[5]*e[15]+e[8]*e[7]*e[13]+e[12]*e[5]*e[11]-e[12]*e[7]*e[9],a[12]=-e[4]*e[9]*e[14]+e[4]*e[10]*e[13]+e[8]*e[5]*e[14]-e[8]*e[6]*e[13]-e[12]*e[5]*e[10]+e[12]*e[6]*e[9],a[1]=-e[1]*e[10]*e[15]+e[1]*e[11]*e[14]+e[9]*e[2]*e[15]-e[9]*e[3]*e[14]-e[13]*e[2]*e[11]+e[13]*e[3]*e[10],a[5]=e[0]*e[10]*e[15]-e[0]*e[11]*e[14]-e[8]*e[2]*e[15]+e[8]*e[3]*e[14]+e[12]*e[2]*e[11]-e[12]*e[3]*e[10],a[9]=-e[0]*e[9]*e[15]+e[0]*e[11]*e[13]+e[8]*e[1]*e[15]-e[8]*e[3]*e[13]-e[12]*e[1]*e[11]+e[12]*e[3]*e[9],a[13]=e[0]*e[9]*e[14]-e[0]*e[10]*e[13]-e[8]*e[1]*e[14]+e[8]*e[2]*e[13]+e[12]*e[1]*e[10]-e[12]*e[2]*e[9],a[2]=e[1]*e[6]*e[15]-e[1]*e[7]*e[14]-e[5]*e[2]*e[15]+e[5]*e[3]*e[14]+e[13]*e[2]*e[7]-e[13]*e[3]*e[6],a[6]=-e[0]*e[6]*e[15]+e[0]*e[7]*e[14]+e[4]*e[2]*e[15]-e[4]*e[3]*e[14]-e[12]*e[2]*e[7]+e[12]*e[3]*e[6],a[10]=e[0]*e[5]*e[15]-e[0]*e[7]*e[13]-e[4]*e[1]*e[15]+e[4]*e[3]*e[13]+e[12]*e[1]*e[7]-e[12]*e[3]*e[5],a[14]=-e[0]*e[5]*e[14]+e[0]*e[6]*e[13]+e[4]*e[1]*e[14]-e[4]*e[2]*e[13]-e[12]*e[1]*e[6]+e[12]*e[2]*e[5],a[3]=-e[1]*e[6]*e[11]+e[1]*e[7]*e[10]+e[5]*e[2]*e[11]-e[5]*e[3]*e[10]-e[9]*e[2]*e[7]+e[9]*e[3]*e[6],a[7]=e[0]*e[6]*e[11]-e[0]*e[7]*e[10]-e[4]*e[2]*e[11]+e[4]*e[3]*e[10]+e[8]*e[2]*e[7]-e[8]*e[3]*e[6],a[11]=-e[0]*e[5]*e[11]+e[0]*e[7]*e[9]+e[4]*e[1]*e[11]-e[4]*e[3]*e[9]-e[8]*e[1]*e[7]+e[8]*e[3]*e[5],a[15]=e[0]*e[5]*e[10]-e[0]*e[6]*e[9]-e[4]*e[1]*e[10]+e[4]*e[2]*e[9]+e[8]*e[1]*e[6]-e[8]*e[2]*e[5],n=1/(n=e[0]*a[0]+e[1]*a[4]+e[2]*a[8]+e[3]*a[12]);for(var r=0;r<16;r++)t[r]=a[r]*n;return t}},{key:"rotate",value:function(e,t,a){var n=new b,r=t,o=Math.cos(r),i=Math.sin(r),s=new E(0,0,0);s.x=a.x,s.y=a.y,s.z=a.z;var l=new E(s.x*(1-o),s.y*(1-o),s.z*(1-o));n[0]=o+l.x*s.x,n[1]=l.x*s.y+i*s.z,n[2]=l.x*s.z-i*s.y,n[4]=l.y*s.x-i*s.z,n[5]=o+l.y*s.y,n[6]=l.y*s.z+i*s.x,n[8]=l.z*s.x+i*s.y,n[9]=l.z*s.y-i*s.x,n[10]=o+l.z*s.z;for(var c=new b,u=0;u<16;u++)c[u]=e[u];return c[0]=e[0]*n[0]+e[4]*n[1]+e[8]*n[2],c[1]=e[1]*n[0]+e[5]*n[1]+e[9]*n[2],c[2]=e[2]*n[0]+e[6]*n[1]+e[10]*n[2],c[4]=e[0]*n[4]+e[4]*n[5]+e[8]*n[6],c[5]=e[1]*n[4]+e[5]*n[5]+e[9]*n[6],c[6]=e[2]*n[4]+e[6]*n[5]+e[10]*n[6],c[8]=e[0]*n[8]+e[4]*n[9]+e[8]*n[10],c[9]=e[1]*n[8]+e[5]*n[9]+e[9]*n[10],c[10]=e[2]*n[8]+e[6]*n[9]+e[10]*n[10],c[12]=e[12],c[13]=e[13],c[14]=e[14],c}},{key:"mul",value:function(e,t){for(var a=new b,n=0;n<4;n++)for(var r=0;r<4;r++){a[4*n+r]=0;for(var o=0;o<4;o++)a[4*n+r]+=t[4*n+o]*e[4*o+r]}return a}},{key:"mulMatV",value:function(e,t){var a=new y(0,0,0,0);return a.x=e[0]*t.x+e[4]*t.y+e[8]*t.z+e[12]*t.w,a.y=e[1]*t.x+e[5]*t.y+e[9]*t.z+e[13]*t.w,a.z=e[2]*t.x+e[6]*t.y+e[10]*t.z+e[14]*t.w,a.w=e[3]*t.x+e[7]*t.y+e[11]*t.z+e[15]*t.w,a}},{key:"dot",value:function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}},{key:"sub",value:function(e,t){var a=new E;return a.x=e.x-t.x,a.y=e.y-t.y,a.z=e.z-t.z,a}},{key:"createTransformationMatrix",value:function(t,a,n,r,o,i,s,l,c){var u=new b;return u=e.translate(u,new E(t,a,n)),u=e.rotate(u,r,new E(1,0,0)),u=e.rotate(u,o,new E(0,1,0)),u=e.rotate(u,i,new E(0,0,1)),u=e.scale(u,new E(s,l,c))}},{key:"createViewMatrix",value:function(e){var t=new b;return t=this.lookAt(e.p,e.a,new E(0,1,0)),t=this.translate(t,new E(-e.p.x,-e.p.y,-e.p.z))}},{key:"createBillBoardMatrix",value:function(e){var t=new b;return t=this.lookAt(e.p,e.a,new E(0,1,0)),t=this.translate(t,new E(-e.p.x,-e.p.y,-e.p.z))}},{key:"createProjectionMatrix",value:function(e,t,a,n,r){var o=n/r,i=1/Math.tan(e/2/360*3.14)*o,s=i/o,l=a-t,c=new b;return c[0]=s,c[5]=i,c[10]=-(a+t)/l,c[11]=-1,c[14]=-2*t*a/l,c[15]=0,c}},{key:"ortho",value:function(e,t,a,n,r,o){var i=new b;return i[0]=2/(t-e),i[5]=2/(n-a),i[10]=-2/(o-r),i[12]=-(t+e)/(t-e),i[13]=-(n+a)/(n-a),i[14]=-(o+r)/(o-r),i}},{key:"distance",value:function(e,t){return Math.sqrt(e.x*t.x+e.y*t.y+e.z*t.z)}},{key:"toRad",value:function(e){return e*Math.PI/180}}]),e}(),k=function e(){Object(h.a)(this,e)};k.vertexShader="precision mediump float;attribute vec2 vertPosition;uniform mat4 projection;uniform mat4 transformation;uniform mat4 view;varying vec2 tex_coords;void main(){vec4 pos =  projection * view * transformation * vec4(vertPosition, 0.0, 1.0);tex_coords = vertPosition * 0.5 + 0.5;tex_coords.y = 1.0-tex_coords.y;gl_Position = pos;}",k.fragmentShader="precision mediump float;uniform sampler2D sampler;uniform float width;uniform float height;uniform float distance;varying vec2 tex_coords;int mod(int a, int b){\treturn a - b * int(a/b);}void main(){vec4 color = vec4(1.0);gl_FragColor = color;}";var C=function e(){Object(h.a)(this,e)};C.vertexShader="precision mediump float;attribute vec3 vertPosition;attribute vec3 normal;attribute mat4 transformation;attribute vec3 color;varying vec2 tex_coords;varying vec3 Normal;varying vec3 fragPos;varying vec3 out_color;uniform mat4 projection;uniform mat4 view;uniform float camera;uniform float max;vec3 hsvtorgb(float h, float s, float v){float i = 0.0;float f = 0.0;float p = 0.0;float q = 0.0;float t = 0.0;vec3 color;if(s==0.0){color.x = v;color.y = v;color.z = v;return color;}h /= 60.0;i = float(int(h));f = h - i;p = v * (1.0 - s);q = v * (1.0 - s*f);t = v * (1.0 - s * (1.0-f));if(i==0.0){color.x = v;color.y = t;color.z = p;}else if(i==1.0){color.x = q;color.y = v;color.z = p;}else if(i==2.0){color.x = p;color.y = v;color.z = t;}else if(i==3.0){color.x = p;color.y = q;color.z = v;}else if(i==4.0){color.x = t;color.y = p;color.z = v;}else{color.x = v;color.y = p;color.z = q;}return color;}void main(){gl_Position = projection * view * transformation * vec4(vec3(vertPosition*camera*0.2), 1.0);out_color = hsvtorgb(180.0-(color.x/max)*180.0, 1.0,1.0);fragPos = vec3(transformation * vec4(vertPosition, 1.0));Normal = normal;}",C.fragmentShader="precision mediump float;varying vec2 tex_coords;varying vec3 Normal;varying vec3 fragPos;varying vec3 out_color;uniform sampler2D sampler;void main(){vec3 norm = normalize(Normal);vec3 lightDir = normalize(vec3(100) - fragPos);float diff = max(dot(norm, lightDir), 0.0); vec3 diffuse = diff * vec3(1); gl_FragColor = vec4(out_color,1.0);}";var S=function(){function e(t,a){Object(h.a)(this,e),this.vao=a.createVertexArray(),a.bindVertexArray(this.vao),this.vertices=t,this.index=0,this.vbo=this.createVBO(a),this.color_vbo=this.createVBO(a),this.shader=new O(a),this.storeData(0,3,t,a),this.maxenergy=0,a.bindVertexArray(null),a.disableVertexAttribArray(0),this.addIntanceAttrib(this.vao,this.vbo,1,4,16,0,a),this.addIntanceAttrib(this.vao,this.vbo,2,4,16,4,a),this.addIntanceAttrib(this.vao,this.vbo,3,4,16,8,a),this.addIntanceAttrib(this.vao,this.vbo,4,4,16,12,a),this.addIntanceAttrib(this.vao,this.color_vbo,5,3,3,0,a),this.drawLines=!1}return Object(d.a)(e,[{key:"render",value:function(e,t,a,n,r){var o=[],i=[];this.index=0,this.colorIndex=0,this.shader.bind(),r.bindVertexArray(this.vao),r.enableVertexAttribArray(0),r.enableVertexAttribArray(1),r.enableVertexAttribArray(2),r.enableVertexAttribArray(3),r.enableVertexAttribArray(4),r.enableVertexAttribArray(5);for(var s=0;s<e.length;s++)this.storeMatrixData(w.createTransformationMatrix(e[s].position.x,e[s].position.y,e[s].position.z,0,0,0,e[s].scale.x,e[s].scale.y,e[s].scale.z),o),this.storeVectorData(e[s].color,i);this.updateVBO(this.vbo,o,r),this.updateVBO(this.color_vbo,i,r),this.drawLines?r.drawArraysInstanced(r.LINES,0,this.vertices.length/2,e.length):r.drawArraysInstanced(r.TRIANGLES,0,this.vertices.length/3,e.length),this.shader.setUniform4fv("view",t),this.shader.setUniform4fv("projection",a),this.shader.setUniform3f("color",1,1,1),this.shader.setUniform("camera",n),this.shader.setUniform("max",this.maxenergy),r.bindVertexArray(null),r.disableVertexAttribArray(0),r.disableVertexAttribArray(1),r.disableVertexAttribArray(2),r.disableVertexAttribArray(3),r.disableVertexAttribArray(4),r.disableVertexAttribArray(5),this.shader.unBind()}},{key:"createVBO",value:function(e){var t=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array(8e4),e.STREAM_DRAW,0),e.bindBuffer(e.ARRAY_BUFFER,null),t}},{key:"storeVectorData",value:function(e,t){t[this.colorIndex++]=e.x,t[this.colorIndex++]=e.y,t[this.colorIndex++]=e.z}},{key:"storeMatrixData",value:function(e,t){for(var a=0;a<16;a++)t[this.index++]=e[a]}},{key:"storeData",value:function(e,t,a,n){var r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,new Float32Array(a),n.STATIC_DRAW,0),n.vertexAttribPointer(e,t,n.FLOAT,n.FALSE,0,0)}},{key:"addIntanceAttrib",value:function(e,t,a,n,r,o,i){i.bindBuffer(i.ARRAY_BUFFER,t),i.bindVertexArray(e),i.vertexAttribPointer(a,n,i.FLOAT,!1,4*r,4*o),i.vertexAttribDivisor(a,1),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindVertexArray(null)}},{key:"updateVBO",value:function(e,t,a){a.bindBuffer(a.ARRAY_BUFFER,e),a.bufferData(a.ARRAY_BUFFER,new Float32Array(t),a.STREAM_DRAW),a.bufferSubData(a.ARRAY_BUFFER,0,new Float32Array(t)),a.bindBuffer(a.ARRAY_BUFFER,null)}}]),e}(),O=function(){function e(t){Object(h.a)(this,e),this.gl=t;var a=C.vertexShader,n=C.fragmentShader,r=t.createShader(t.VERTEX_SHADER),o=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(r,a),t.shaderSource(o,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?(t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?(this.program=t.createProgram(),t.attachShader(this.program,r),t.attachShader(this.program,o),t.bindAttribLocation(this.program,0,"vertPosition"),t.bindAttribLocation(this.program,1,"transformation"),t.bindAttribLocation(this.program,5,"color"),t.linkProgram(this.program),t.getProgramParameter(this.program,t.LINK_STATUS)?(t.validateProgram(this.program),t.getProgramParameter(this.program,t.VALIDATE_STATUS)||console.error("ERROR validating program!",t.getProgramInfoLog(this.program))):console.error("ERROR linking program!",t.getProgramInfoLog(this.program))):console.error("ERROR compiling fragment shader!",t.getShaderInfoLog(o))):console.error("ERROR compiling vertex shader!",t.getShaderInfoLog(r))}return Object(d.a)(e,[{key:"bind",value:function(){this.gl.useProgram(this.program)}},{key:"unBind",value:function(){this.gl.useProgram(null)}},{key:"setUniform",value:function(e,t){var a=this.gl.getUniformLocation(this.program,e);-1!=a&&this.gl.uniform1f(a,t)}},{key:"setUniform1i",value:function(e,t){var a=this.gl.getUniformLocation(this.program,e);-1!=a&&this.gl.uniform1i(a,t)}},{key:"setUniform3f",value:function(e,t,a,n){var r=this.gl.getUniformLocation(this.program,e);-1!=r&&this.gl.uniform3f(r,t,a,n)}},{key:"setUniform4fv",value:function(e,t){var a=this.gl.getUniformLocation(this.program,e);-1!=a&&this.gl.uniformMatrix4fv(a,!1,t)}}]),e}(),j=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.shader=new g([0,"vertPosition"],k,t),this.vertices=[-1,1,1,1,-1,-1,1,-1,1,1,-1,-1],this.vertical=[1,0,0,-1,0,0],this.horizontal=[0,0,1,0,0,-1],this.vao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.vao),this.gl.enableVertexAttribArray(0),this.vbo=t.createBuffer(),this.gl.bindBuffer(t.ARRAY_BUFFER,this.vbo),this.gl.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertical),t.STATIC_DRAW,0),this.gl.vertexAttribPointer(0,2,t.FLOAT,t.FALSE,0,0),this.gl.bindVertexArray(null),this.gl.disableVertexAttribArray(0),this.verticalRenderer=new S(this.vertical,this.gl),this.verticalRenderer.drawLines=!0,this.horizontalRenderer=new S(this.horizontal,this.gl),this.horizontalRenderer.drawLines=!0;var a=function e(t,a,n,r,o,i){Object(h.a)(this,e),this.position=new E(t,a,n),this.scale=new E(r,o,i),this.color=new E(1,1,1)};this.lines=[];for(var n=-100;n<100;n++)this.lines.push(new a(0,0,100*n,10,1,1));for(var r=-100;r<100;r++)this.lines.push(new a(100*r,0,0,1,1,10))}return Object(d.a)(e,[{key:"draw",value:function(e,t,a,n,r,o){var i=100;r>1e3&&(i=5e3),r>200&&r<1e3&&(i=500),r<200&&r>20&&(i=100),r<20&&(i=10),o(i/100+" cm");for(var s=0;s<200;s++)this.lines[s].position.z=i*s/100-i,this.lines[s].scale.x=i/200;for(var l=200;l<400;l++)this.lines[l].position.x=i*(l-200)/100-i,this.lines[l].scale.z=i/200;this.verticalRenderer.render(this.lines,w.createViewMatrix(t),e,1e3,this.gl),this.horizontalRenderer.render(this.lines,w.createViewMatrix(t),e,1e3,this.gl)}}]),e}(),D=function e(){Object(h.a)(this,e)};D.vertexShader="precision mediump float;attribute vec3 vertPosition;attribute vec3 normal;varying vec2 tex_coords;varying vec3 Normal;varying vec3 fragPos;uniform mat4 projection;uniform mat4 transformation;uniform mat4 view;void main(){gl_Position = projection * view * transformation * vec4(vertPosition, 1.0);fragPos = vec3(transformation * vec4(vertPosition, 1.0));Normal = normal;}",D.fragmentShader="precision mediump float;varying vec2 tex_coords;varying vec3 Normal;varying vec3 fragPos;uniform vec3 color;uniform sampler2D sampler;uniform int fakeLightning;void main(){vec3 norm = normalize(Normal);vec3 lightDir = vec3(1,0.5,0);float diff = max(dot(norm, lightDir), 0.0); vec3 diffuse = diff * vec3(1); if(fakeLightning == 1) diffuse = vec3(.9);gl_FragColor = vec4((vec3(.1)+diffuse)*color,1.0);}";var A=function(){function e(t,a,n){Object(h.a)(this,e),this.vertices=t,this.normals=a,this.gl=n,this.color=new E(.1,.1,.1),this.drawLines=!0,this.outline=!0,this.position=new E(0,0,0),this.rotation=new E(0,0,0),this.scale=new E(1,1,1),this.vao=n.createVertexArray(),n.bindVertexArray(this.vao),this.vbo=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vbo),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n.STATIC_DRAW,0),n.vertexAttribPointer(0,3,n.FLOAT,n.FALSE,0,0),this.nvbo=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.nvbo),n.bufferData(n.ARRAY_BUFFER,new Float32Array(this.normals),n.STATIC_DRAW,0),n.vertexAttribPointer(1,3,n.FLOAT,n.FALSE,0,0),n.bindVertexArray(null)}return Object(d.a)(e,[{key:"draw",value:function(){this.drawLines?this.gl.drawArrays(this.gl.LINE_STRIP,0,this.vertices.length/3):this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices.length/3)}}]),e}(),z=function e(){Object(h.a)(this,e)};z.vertices=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5],z.normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0];var M=function e(t,a){Object(h.a)(this,e),this.origin=t,this.direction=a},R=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"check",value:function(e,t,a,n,r){this.d=1/0;for(var o=-1,i=0;i<e.length;i++){var s=w.createTransformationMatrix(e[i].model.position.x,e[i].model.position.y,e[i].model.position.z,e[i].model.rotation.x,e[i].model.rotation.y,e[i].model.rotation.z,e[i].model.scale.x,e[i].model.scale.y,e[i].model.scale.z);this.checkModel(n,e[i].model.vertices,s)&&(o=e[i].id)}this.d=1/0;for(i=0;i<a.length;i++){var l=new E(0,0,0);l.x=Math.atan2(-a[i].direction.y,a[i].direction.z),l.z=Math.atan2(a[i].direction.x,-a[i].direction.y),l.y=Math.atan2(a[i].direction.x,a[i].direction.z);var c=w.createTransformationMatrix(a[i].model.position.x,a[i].model.position.y,a[i].model.position.z,l.x,l.y,l.z,.01*r.d,.01*r.d,.01*r.d);this.checkModel(n,a[i].model.vertices,c)&&(o=a[i].id)}this.d=1/0;for(i=0;i<t.length;i++){var u=w.createTransformationMatrix(t[i].model.position.x,t[i].model.position.y,t[i].model.position.z,t[i].model.rotation.x,t[i].model.rotation.y,t[i].model.rotation.z,.004*r.d,.004*r.d,.004*r.d);this.checkModel(n,t[i].model.vertices,u)&&(o=t[i].id)}return o}},{key:"checkModel",value:function(e,t,a){for(var n=!1,r=0;r<t.length;r+=9){var o,i,s;o=w.mulMatV(a,new y(t[r],t[r+1],t[r+2],1)),i=w.mulMatV(a,new y(t[r+3],t[r+4],t[r+5],1)),s=w.mulMatV(a,new y(t[r+6],t[r+7],t[r+8],1)),this.triangleHit(e,o.xyz(),i.xyz(),s.xyz())&&(n=!0)}return n}},{key:"triangleHit",value:function(e,t,a,n){var r=w.sub(a,t),o=w.sub(n,t),i=w.cross(e.direction,o),s=w.dot(r,i);if(s<1e-5)return!1;var l=1/s,c=w.sub(e.origin,t),u=w.dot(c,i)*l;if(u<0||u>1)return!1;var h=w.cross(c,r),d=w.dot(e.direction,h)*l;return!(d<0||d+u>1)&&((c=w.dot(o,h)*l)>0&&c<this.d&&(this.d=c,!0))}},{key:"cameraRay",value:function(e,t,a,n){var r=new M,o=w.invert(w.createViewMatrix(e)),i=w.mulMatV(o,new y(0,0,0,1)).xyz(),s=w.invert(t),l=w.mulMatV(s,new y(a,n,0,1)).xyz();return l=w.mulMatV(o,new y(l.x,l.y,l.z,0)).xyz(),l=w.normalize(l),r.direction=l,r.origin=i,r}}]),e}();R.d=1/0;var T=R,L=function(){function e(t){Object(h.a)(this,e),this.shader=new g([[0,"vertPosition"],[1,"normal"]],D,t),this.models=[],this.sources=[],this.detectors=[],this.guns=[],this.particles=[],this.gl=t,this.addModel(new A([1,0,0,-1,0,0],[1,1,1,1,1,1],t)),this.addModel(new A([0,1,0,0,-1,0],[1,1,1,1,1,1],t)),this.addModel(new A([0,0,1,0,0,-1],[1,1,1,1,1,1],t)),this.addModel(new A([0,0,0,0,0,0],[1,1,1,1,1,1],t)),this.models[0].color=new E(1,0,0),this.models[1].color=new E(0,1,0),this.models[2].color=new E(0,0,1),this.drawTracks=!0,this.drawParticles=!0,this.drawAxes=!0}return Object(d.a)(e,[{key:"removeDetector",value:function(e){for(var t=0;t<this.detectors.length;t++)this.detectors[t]==e&&this.detectors.splice(t,1)}},{key:"removeGun",value:function(e){for(var t=0;t<this.guns.length;t++)this.guns[t]==e&&this.guns.splice(t,1)}},{key:"removeSource",value:function(e){for(var t=0;t<this.sources.length;t++)this.sources[t]==e&&this.sources.splice(t,1)}},{key:"addModel",value:function(e){this.models.push(e)}},{key:"addParticles",value:function(e){this.particles.push(e)}},{key:"addGun",value:function(e){this.guns.push(e)}},{key:"addSource",value:function(e){this.sources.push(e)}},{key:"addDetector",value:function(e){this.detectors.push(e)}},{key:"clearSetup",value:function(){this.detectors=[],this.sources=[],this.guns=[]}},{key:"clearTracks",value:function(){this.models=[],this.addModel(new A([1,0,0,-1,0,0],[1,1,1,1,1,1],this.gl)),this.addModel(new A([0,1,0,0,-1,0],[1,1,1,1,1,1],this.gl)),this.addModel(new A([0,0,1,0,0,-1],[1,1,1,1,1,1],this.gl)),this.addModel(new A([0,0,0,0,0,0],[1,1,1,1,1,1],this.gl)),this.models[0].color=new E(1,0,0),this.models[1].color=new E(0,1,0),this.models[2].color=new E(0,0,1)}},{key:"drawObject",value:function(e,t,a,n,r,o,i){this.gl.enableVertexAttribArray(0),this.gl.enableVertexAttribArray(1),this.gl.bindVertexArray(e.model.vao);var s=w.createTransformationMatrix(e.model.position.x,e.model.position.y,e.model.position.z,e.model.rotation.x,e.model.rotation.y,e.model.rotation.z,e.model.scale.x*n,e.model.scale.y*n,e.model.scale.z*n);null!=i&&(s=i),this.shader.setUniform1i("fakeLightning",o),this.shader.setUniform3f("color",r.x,r.y,r.z),this.shader.setUniform1i("sampler",0),this.shader.setUniform4fv("view",w.createViewMatrix(a)),this.shader.setUniform4fv("projection",t),this.shader.setUniform4fv("transformation",s),e.model.draw(),this.gl.disableVertexAttribArray(0),this.gl.disableVertexAttribArray(1)}},{key:"draw",value:function(t,a,n,r,o,i){this.shader.bind(),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK);var s=T.cameraRay(a,t,n,r);e.hover_id=T.check(this.detectors,this.sources,this.guns,s,a),this.gl.enable(this.gl.DEPTH_TEST);for(var l=0;l<this.detectors.length;l++)this.drawObject(this.detectors[l],t,a,1,this.detectors[l].model.color,0);for(var c=0;c<this.guns.length;c++);this.gl.disable(this.gl.DEPTH_TEST);for(var u=0;u<this.sources.length;u++);this.gl.enable(this.gl.CULL_FACE),this.gl.disable(this.gl.DEPTH_TEST);for(var h=0;h<this.detectors.length;h++)this.gl.cullFace(this.gl.FRONT),this.detectors[h].id==e.active_id&&(this.drawObject(this.detectors[h],t,a,1.01,new E(1,.4,0),1),this.gl.cullFace(this.gl.BACK),this.drawObject(this.detectors[h],t,a,1,this.detectors[h].model.color,0)),this.detectors[h].id==e.hover_id&&(this.detectors[h].id==e.hover_id&&(this.drawObject(this.detectors[h],t,a,1.01,new E(1,1,0),1),this.gl.cullFace(this.gl.BACK),this.drawObject(this.detectors[h],t,a,1,this.detectors[h].model.color,0)),this.gl.enable(this.gl.DEPTH_TEST));this.gl.disable(this.gl.DEPTH_TEST);for(var d=0;d<this.guns.length;d++){var m=new E(0,0,0);m.x=Math.atan2(-this.guns[d].direction.y,this.guns[d].direction.z),m.z=Math.atan2(this.guns[d].direction.x,-this.guns[d].direction.y),m.y=Math.atan2(this.guns[d].direction.x,this.guns[d].direction.z);var p=w.createTransformationMatrix(this.guns[d].model.position.x,this.guns[d].model.position.y,this.guns[d].model.position.z,m.x,m.y,m.z,.01*a.d,.01*a.d,.01*a.d);this.drawObject(this.guns[d],t,a,.01*a.d,this.guns[d].model.color,0,p),this.guns[d].id==e.active_id&&(p=w.createTransformationMatrix(this.guns[d].model.position.x,this.guns[d].model.position.y,this.guns[d].model.position.z,m.x,m.y,m.z,.011*a.d,.011*a.d,.011*a.d),this.drawObject(this.guns[d],t,a,1.01*this.guns[d].model.scale.x,new E(1,.4,0),1,p),this.gl.cullFace(this.gl.BACK),p=w.createTransformationMatrix(this.guns[d].model.position.x,this.guns[d].model.position.y,this.guns[d].model.position.z,m.x,m.y,m.z,.01*a.d,.01*a.d,.01*a.d),this.drawObject(this.guns[d],t,a,this.guns[d].model.scale.x,this.guns[d].model.color,0,p)),this.guns[d].id==e.hover_id&&(this.guns[d].id==e.hover_id&&(p=w.createTransformationMatrix(this.guns[d].model.position.x,this.guns[d].model.position.y,this.guns[d].model.position.z,m.x,m.y,m.z,.011*a.d,.011*a.d,.011*a.d),this.drawObject(this.guns[d],t,a,.1*a.d,new E(1,1,0),1,p),this.gl.cullFace(this.gl.BACK),p=w.createTransformationMatrix(this.guns[d].model.position.x,this.guns[d].model.position.y,this.guns[d].model.position.z,m.x,m.y,m.z,.01*a.d,.01*a.d,.01*a.d),this.drawObject(this.guns[d],t,a,.01*a.d,this.guns[d].model.color,0,p)))}this.gl.disable(this.gl.DEPTH_TEST);for(d=0;d<this.sources.length;d++)this.drawObject(this.sources[d],t,a,.004*a.d,this.sources[d].model.color,0),this.sources[d].id==e.active_id&&(this.drawObject(this.sources[d],t,a,.005*a.d,new E(1,.4,0),1),this.gl.cullFace(this.gl.BACK),this.drawObject(this.sources[d],t,a,.004*a.d,this.sources[d].model.color,0)),this.sources[d].id==e.hover_id&&(this.sources[d].id==e.hover_id&&(this.drawObject(this.sources[d],t,a,.005*a.d,new E(1,1,0),1),this.gl.cullFace(this.gl.BACK),this.drawObject(this.sources[d],t,a,.004*a.d,this.sources[d].model.color,0)),this.gl.enable(this.gl.DEPTH_TEST));if(this.gl.disable(this.gl.DEPTH_TEST),this.drawAxes)for(var f=0;f<4;f++){this.gl.enableVertexAttribArray(0),this.gl.enableVertexAttribArray(1),this.gl.bindVertexArray(this.models[f].vao);var g=w.createTransformationMatrix(this.models[f].position.x,this.models[f].position.y,this.models[f].position.z,this.models[f].rotation.x,this.models[f].rotation.y,this.models[f].rotation.z,a.d,a.d,a.d);this.shader.setUniform3f("color",this.models[f].color.x,this.models[f].color.y,this.models[f].color.z),this.shader.setUniform1i("fakeLightning",1),this.shader.setUniform4fv("transformation",g),this.models[f].draw(),this.gl.disableVertexAttribArray(0),this.gl.disableVertexAttribArray(1)}if(this.drawTracks){for(var v=3;v<this.models.length;v++){this.gl.enableVertexAttribArray(0),this.gl.enableVertexAttribArray(1),this.gl.bindVertexArray(this.models[v].vao);var b=w.createTransformationMatrix(this.models[v].position.x,this.models[v].position.y,this.models[v].position.z,this.models[v].rotation.x,this.models[v].rotation.y,this.models[v].rotation.z,this.models[v].scale.x,this.models[v].scale.y,this.models[v].scale.z);this.shader.setUniform3f("color",this.models[v].color.x,this.models[v].color.y,this.models[v].color.z),this.shader.setUniform1i("fakeLightning",1),this.shader.setUniform1i("sampler",0),this.shader.setUniform4fv("view",w.createViewMatrix(a)),this.shader.setUniform4fv("projection",t),this.shader.setUniform4fv("transformation",b),this.models[v].draw(),this.gl.disableVertexAttribArray(0),this.gl.disableVertexAttribArray(1)}this.shader.unBind(),this.gl.disable(this.gl.DEPTH_TEST)}else this.shader.unBind()}}]),e}();L.active_id=-1,L.hover_id=-1;var P=L,F=function(){function e(t){Object(h.a)(this,e),this.model=t,this.material="Pb",this.active=!1,this.deposit=0,this.name="",this.id=0,this.hits=[],this.geometry="cube",this.numberOfHits=[],this.units=[1,1,1]}return Object(d.a)(e,[{key:"contains",value:function(e){for(var t=0;t<this.hits.length;t++)if(e==this.hits[t])return!0;return!1}},{key:"clearDeposit",value:function(){this.hits=[],this.numberOfHits=[]}},{key:"sort",value:function(){for(var e=[],t=0;t<this.hits.length;t++)e.push({hit:this.hits[t],no:this.numberOfHits[t]});e.sort((function(e,t){return e.hit<t.hit?-1:e.hit==t.hit?0:1}));for(var a=0;a<e.length;a++)this.hits[a]=e[a].hit,this.numberOfHits[a]=e[a].no}},{key:"getIndex",value:function(e){for(var t=0;t<this.hits.length;t++)if(0==Math.abs(e-this.hits[t]))return t;return-1}}]),e}(),V=function e(t,a,n,r){Object(h.a)(this,e),this.position=a,this.direction=n,this.energy=r,this.model=t,this.name="Particle Gun",this.units=[1,1]},N=function e(){Object(h.a)(this,e)};N.vertices=[-1,-1,-1,0,0,1,0,0,1,-1,-1,-1,0,0,1,-1,1,-1,-1,1,-1,0,0,1,0,0,1,-1,1,-1,0,0,1,1,1,-1,1,1,-1,0,0,1,0,0,1,1,1,-1,0,0,1,1,-1,-1,1,-1,-1,0,0,1,0,0,1,1,-1,-1,0,0,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],N.normals=[0,0,0,0,0,0,0,0,0,-.8944271802902222,0,.4472135901451111,-.8944271802902222,0,.4472135901451111,-.8944271802902222,0,.4472135901451111,0,0,0,0,0,0,0,0,0,0,.8944271802902222,.4472135901451111,0,.8944271802902222,.4472135901451111,0,.8944271802902222,.4472135901451111,0,0,0,0,0,0,0,0,0,.8944271802902222,0,.4472135901451111,.8944271802902222,0,.4472135901451111,.8944271802902222,0,.4472135901451111,0,0,0,0,0,0,0,0,0,0,-.8944271802902222,.4472135901451111,0,-.8944271802902222,.4472135901451111,0,-.8944271802902222,.4472135901451111,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var B=function e(t,a,n){Object(h.a)(this,e),this.position=a,this.name="Particle Source",this.scale=new E(1,1,1),this.material=n,this.model=t,this.model.color=new E(0,1,0),this.active=!1,this.id=0,this.units=[1]},I=function e(){Object(h.a)(this,e)};I.vertexShader="precision mediump float;attribute vec2 vertPosition;varying vec2 textures;uniform mat4 transformation;void main(){gl_Position = transformation * vec4(vertPosition, 0.0, 1.0);textures = vertPosition * 0.5 - 0.5;}",I.fragmentShader="precision mediump float;varying vec2 textures;vec3 hsvtorgb(float h, float s, float v){float i = 0.0;float f = 0.0;float p = 0.0;float q = 0.0;float t = 0.0;vec3 color;if(s==0.0){color.x = v;color.y = v;color.z = v;return color;}h /= 60.0;i = float(int(h));f = h - i;p = v * (1.0 - s);q = v * (1.0 - s*f);t = v * (1.0 - s * (1.0-f));if(i==0.0){color.x = v;color.y = t;color.z = p;}else if(i==1.0){color.x = q;color.y = v;color.z = p;}else if(i==2.0){color.x = p;color.y = v;color.z = t;}else if(i==3.0){color.x = p;color.y = q;color.z = v;}else if(i==4.0){color.x = t;color.y = p;color.z = v;}else{color.x = v;color.y = p;color.z = q;}return color;}void main(){gl_FragColor = vec4(hsvtorgb(((-1.0-textures.y)+1.0)*180.0,1.0,1.0),1.0);}";var _=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.shader=new g([[0,"vertPosition"]],I,t),this.vertices=[-1,1,1,1,-1,-1,1,-1,1,1,-1,-1],this.vao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.vao),this.gl.enableVertexAttribArray(0),this.vbo=t.createBuffer(),this.gl.bindBuffer(t.ARRAY_BUFFER,this.vbo),this.gl.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW,0),this.gl.vertexAttribPointer(0,2,t.FLOAT,t.FALSE,0,0),this.gl.bindVertexArray(null),this.gl.disableVertexAttribArray(0)}return Object(d.a)(e,[{key:"draw",value:function(){this.shader.bind(),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.CULL_FACE);var e=w.createTransformationMatrix(.5,-.8,0,0,0,0,.02,.15,.1);this.gl.enableVertexAttribArray(0),this.gl.bindVertexArray(this.vao),this.shader.setUniform4fv("transformation",e),this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices.length/2),this.gl.bindVertexArray(null),this.gl.disableVertexAttribArray(0),this.shader.unBind()}}]),e}(),U=function e(){Object(h.a)(this,e)};U.vertexShader="precision mediump float;attribute vec3 vertices;uniform mat4 view;uniform mat4 transformation;uniform mat4 projection;uniform mat4 bmat;uniform float camerad;uniform vec3 pos;void main(){gl_Position = transformation * vec4(( bmat*vec4(vertices,1.0) + vec4(pos,0.0)).xyz*camerad*.03, 1.0);}",U.fragmentShader="precision mediump float;uniform vec3 color;void main(){gl_FragColor = vec4(color, 1.0);}";var H=function(){function e(t){Object(h.a)(this,e),this.gl=t,this.shader=new g([[0,"vertices"]],U,t),this.allaxis=[],this.labels=[],this.xaxis=new A([1,0,0,0,0,0],[1,1,1,1,1,1],t),this.yaxis=new A([0,1,0,0,0,0],[1,1,1,1,1,1],t),this.zaxis=new A([0,0,1,0,0,0],[1,1,1,1,1,1],t),this.xlabel=new A([1,0,0,.5,-.5,0,.75,-.25,0,.5,0,0,1,-.5,0],[],t),this.ylabel=new A([1,0,0,.75,-.25,0,.5,0,0,.75,-.25,0,.75,-.5,0],[],t),this.zlabel=new A([1,0,0,.5,0,0,1,-.5,0,.5,-.5,0],[],t),this.xlabel.scale=new E(.3,.3,.3),this.xlabel.position=new E(3,-.5,0),this.ylabel.scale=new E(.3,.3,.3),this.ylabel.position=new E(-.5,4,0),this.zlabel.scale=new E(.3,.3,.3),this.zlabel.position=new E(0,-.5,3),this.xlabel.color=new E(1,1,1),this.ylabel.color=new E(1,1,1),this.zlabel.color=new E(1,1,1),this.xaxis.color=new E(1,0,0),this.yaxis.color=new E(0,1,0),this.zaxis.color=new E(0,0,1),this.xaxis.drawLines=!0,this.yaxis.drawLines=!0,this.zaxis.drawLines=!0,this.xlabel.drawLines=!0,this.ylabel.drawLines=!0,this.zlabel.drawLines=!0,this.allaxis.push(this.xaxis),this.allaxis.push(this.yaxis),this.allaxis.push(this.zaxis),this.labels.push(this.xlabel),this.labels.push(this.ylabel),this.labels.push(this.zlabel)}return Object(d.a)(e,[{key:"draw",value:function(e,t){this.shader.bind(),this.gl.disable(this.gl.DEPTH_TEST);for(var a=0;a<this.allaxis.length;a++){var n=w.createTransformationMatrix(-.5,-.7,0,0,0,0,this.allaxis[a].scale.x,this.allaxis[a].scale.y,this.allaxis[a].scale.z);n=w.mul(n,e),n=w.mul(n,w.createViewMatrix(t)),n=w.translate(n,new E(t.a.x+this.allaxis[a].position.x,t.a.y+this.allaxis[a].position.y,t.a.z+this.allaxis[a].position.z)),this.shader.setUniform("camerad",t.d),this.shader.setUniform3f("pos",0,0,0);var r=w.createTransformationMatrix(0,0,0,0,0,0,1,1,1);r=w.rotate(r,0,new E(0,1,0)),this.shader.setUniform4fv("bmat",r),this.shader.setUniform4fv("transformation",n),this.gl.enableVertexAttribArray(0),this.gl.bindVertexArray(this.allaxis[a].vao),this.shader.setUniform3f("color",this.allaxis[a].color.x,this.allaxis[a].color.y,this.allaxis[a].color.z),this.allaxis[a].draw(),this.gl.disableVertexAttribArray(0)}for(var o=0;o<this.labels.length;o++){n=w.createTransformationMatrix(-.5,-.7,0,0,0,0,this.labels[o].scale.x,this.labels[o].scale.y,this.labels[o].scale.z);n=w.mul(n,e),n=w.mul(n,w.createViewMatrix(t)),n=w.translate(n,new E(t.a.x,t.a.y,t.a.z));r=w.createTransformationMatrix(0,0,0,0,0,0,1,1,1);r=w.rotate(r,w.toRad(t.x),new E(0,1,0)),r=w.rotate(r,w.toRad(-t.y),new E(1,0,0)),this.shader.setUniform("camerad",t.d),this.shader.setUniform3f("pos",this.labels[o].position.x,this.labels[o].position.y,this.labels[o].position.z),this.shader.setUniform4fv("transformation",n),this.shader.setUniform4fv("bmat",r),this.gl.enableVertexAttribArray(0),this.gl.bindVertexArray(this.labels[o].vao),this.shader.setUniform3f("color",this.labels[o].color.x,this.labels[o].color.y,this.labels[o].color.z),this.labels[o].draw(),this.gl.disableVertexAttribArray(0)}this.shader.unBind()}}]),e}(),G=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"writeData",value:function(e){var t="Created at radsim.inf.elte.hu";for(;t.length<80;)t+=".";var a=e.vertices.length/9;!function(e){t+=String.fromCharCode(e),t+=String.fromCharCode(e>>8),t+=String.fromCharCode(e>>16),t+=String.fromCharCode(e>>24)}(a);for(var n=0;n<a;n++){for(var r=0;r<3;r++)i(e.normals[9*n+r]);for(var o=0;o<9;o++)i(e.vertices[9*n+o]);t+=".."}function i(e){var a=new Float32Array(1);a[0]=e;var n=new Uint8Array(a.buffer);t+=String.fromCharCode(n[0]),t+=String.fromCharCode(n[1]),t+=String.fromCharCode(n[2]),t+=String.fromCharCode(n[3])}return t}},{key:"parseData",value:function(e){function t(e,t){var a=new Uint8Array([e.charCodeAt(t),e.charCodeAt(t+1),e.charCodeAt(t+2),e.charCodeAt(t+3)]);return new Float32Array(a.buffer)[0]}var a=[],n=[],r=function(e,t){var a=new Uint8Array([e.charCodeAt(t),e.charCodeAt(t+1),e.charCodeAt(t+2),e.charCodeAt(t+3)]);return new Int32Array(a.buffer)[0]}(e,80);if(r>1e4||r<=0)return null;for(var o=0;o<r;o++)for(var i=0;i<9;i++)a.push(t(e,96+4*i+50*o));for(o=0;o<r;o++){for(i=0;i<3;i++)n.push(t(e,84+4*i+50*o));for(i=0;i<3;i++)n.push(t(e,84+4*i+50*o));for(i=0;i<3;i++)n.push(t(e,84+4*i+50*o))}var s=new q;return s.vertices=a,s.normals=n,s}}]),e}(),q=function e(){Object(h.a)(this,e),this.vertices=[],this.normals=[]},Y=G,K=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"init",value:function(t){e.editor=t}},{key:"checkVolumeName",value:function(t){for(var a=0;a<e.volumes.length;a++)if(e.volumes[a].name==t)return!1;return!0}},{key:"addVolume",value:function(t){e.checkVolumeName(t.name)&&e.volumes.push(t)}},{key:"removeAll",value:function(){e.volumes=[]}},{key:"removeVolume",value:function(t){for(var a=0;a<e.volumes.length;a++)t==e[a]&&e.volumes.splice(a,1)}},{key:"getVolume",value:function(t){for(var a=0;a<e.volumes.length;a++)if(e.volumes[a].name==t)return e.volumes[a];alert("Volume not found!\n"+t)}},{key:"updateVolume",value:function(t,a,n,r){var o=e.getVolume(t);o.name=a,r.forEach((function(e){e.geometry==t&&(e.geometry=a)})),void 0!=n&&n.length>0&&(o.data=n),e.editor.renameGeometry(t,a,r)}}]),e}();K.editor=null,K.volumes=[];var X=K,W=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var r;return Object(h.a)(this,a),(r=t.call(this,e)).state={hint:" ",colorMinHint:"0 keV",colorMaxHint:"0 keV"},r.canvas=Object(n.createRef)(),r.camera=new x(45,-45,100,new E(0,0,0),new E(0,0,0)),r.oldX=0,r.oldY=0,r.move=!1,r.x=0,r.y=0,r.keyDown=" ".concat(0),r.down=!1,r.rightclick=!1,r.renderer=null,r.instanceRenderer=null,r.axisRenderer=null,r.particles=[],r.drawTracks=!1,r.drawParticles=!0,r.drawGrid=!1,r.gl=null,r.detector_buttons=[],r.source_buttons=[],r.gun_buttons=[],r.updateHint=r.updateHint.bind(Object(m.a)(r)),r.updateColorHint=r.updateColorHint.bind(Object(m.a)(r)),r}return Object(d.a)(a,[{key:"updateColorHint",value:function(e,t){this.setState({colorMaxHint:e,colorMinHint:t})}},{key:"updateHint",value:function(e){this.setState({hint:e})}},{key:"setShowTracks",value:function(e){this.renderer.drawTracks=e}},{key:"setShowAxes",value:function(e){this.renderer.drawAxes=e}},{key:"getMouseXd",value:function(){return this.oldX-this.x}},{key:"getMouseYd",value:function(){return this.oldY-this.y}},{key:"clearRun",value:function(){this.particles=[],this.renderer.clearTracks()}},{key:"componentDidMount",value:function(){var e=this;this.canvas.current.oncontextmenu=function(t){e.rightclick=!0;for(var a=-1,n=0;n<e.detector_buttons.length;n++)e.detector_buttons[n].current.id==P.hover_id&&(e.detector_buttons[n].current.accordion.current.click(),a=e.detector_buttons[n].current.id);console.log(e.source_buttons.length);for(n=0;n<e.source_buttons.length;n++)e.source_buttons[n].current.id==P.hover_id&&(e.source_buttons[n].current.accordion.current.click(),a=e.source_buttons[n].current.id);for(n=0;n<e.gun_buttons.length;n++)e.gun_buttons[n].current.id==P.hover_id&&(e.gun_buttons[n].current.accordion.current.click(),a=e.gun_buttons[n].current.id);if(-1==a){for(n=0;n<e.detector_buttons.length;n++)e.detector_buttons[n].current.id==P.active_id&&e.detector_buttons[n].current.accordion.current.click();for(n=0;n<e.source_buttons.length;n++)e.source_buttons[n].current.id==P.active_id&&e.source_buttons[n].current.accordion.current.click();for(n=0;n<e.gun_buttons.length;n++)e.gun_buttons[n].current.id==P.active_id&&e.gun_buttons[n].current.accordion.current.click()}t.preventDefault(),t.stopPropagation()},this.gl=this.canvas.current.getContext("webgl2");var t=new j(this.gl);this.renderer=new P(this.gl),this.instanceRenderer=new S(z.vertices,this.gl),this.guiRenderer=new _(this.gl),this.axisRenderer=new H(this.gl);requestAnimationFrame((function a(){e.gl.clearColor(.2,.2,.2,1),e.gl.clear(e.gl.COLOR_BUFFER_BIT);var n,r=w.createProjectionMatrix(70,.1*e.camera.d,1e3*e.camera.d,e.canvas.current.offsetWidth,e.canvas.current.offsetHeight);e.down&&e.move&&(17===e.keyDown?(e.camera.a.y-=.01*e.getMouseYd()*e.camera.d*((89-Math.abs(e.camera.y))/89)*.01,e.camera.a.x-=Math.cos(e.camera.x/(180/Math.PI))*e.getMouseXd()*.01*e.camera.d*((89-Math.abs(e.camera.y))/89)*.01,e.camera.a.z+=Math.sin(e.camera.x/(180/Math.PI))*e.getMouseXd()*.01*e.camera.d*((89-Math.abs(e.camera.y))/89)*.01,e.camera.a.x-=.01*(Math.cos(e.camera.x/(180/Math.PI))*e.getMouseXd()*.01*e.camera.d+Math.sin(e.camera.x/(180/Math.PI))*e.getMouseYd()*.01*e.camera.d),e.camera.a.z-=.01*(Math.cos(e.camera.x/(180/Math.PI))*e.getMouseYd()*.01*e.camera.d+Math.sin(e.camera.x/(180/Math.PI))*-e.getMouseXd()*.01*e.camera.d)):(e.camera.x+=e.getMouseXd()/2,e.camera.y+=e.getMouseYd()/2)),(n=e.camera).y>89&&(n.y=89),n.y<-89&&(n.y=-89),n.p.x=n.d*-Math.sin(w.toRad(n.x))*Math.cos(w.toRad(n.y))+n.a.x,n.p.y=n.d*-Math.sin(w.toRad(n.y))+n.a.y,n.p.z=-n.d*Math.cos(w.toRad(n.x))*Math.cos(w.toRad(n.y))+n.a.z,e.drawGrid&&t.draw(r,e.camera,e.canvas.current.offsetWidth,e.canvas.current.offsetHeight,e.camera.d,e.updateHint),e.renderer.draw(r,e.camera,e.x/e.canvas.current.offsetWidth*2-1,(e.canvas.current.offsetHeight-e.y)/e.canvas.current.offsetHeight*2-1,e.rightclick,e.move),e.drawParticles&&e.instanceRenderer.render(e.particles,w.createViewMatrix(e.camera),r,e.camera.d,e.gl),e.guiRenderer.draw(),e.axisRenderer.draw(r,e.camera),e.move=!1,e.rightclick=!1,requestAnimationFrame(a)}))}},{key:"addSource",value:function(e,t,a,n){var r=new B(new A(z.vertices,z.normals,this.gl),new E(e,t,a),n);return r.model.drawLines=!1,r.model.position=new E(e,t,a),this.renderer.addSource(r),r}},{key:"addParticle",value:function(e){this.particles.push(e)}},{key:"addSTLDetector",value:function(e,t,a,n,r,o,i,s,l,c,u){var h=new F(new A(u.vertices,u.normals,this.gl));return h.model.drawLines=!1,h.model.color=new E(1,1,1),h.model.position.x=e,h.model.position.y=t,h.model.position.z=a,h.model.rotation.x=n,h.model.rotation.y=r,h.model.rotation.z=o,h.model.scale.x=i,h.model.scale.y=s,h.model.scale.z=l,h.material=c,this.renderer.addDetector(h),h}},{key:"addDetector",value:function(){var e=Object(u.a)(c.a.mark((function e(t,a,n,r,o,i,s,l,u,h,d,m){var p,f,g,v,b,y=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(p=null,f=function(){p.model.drawLines=!1,p.model.color=new E(1,1,1),p.model.position.x=t,p.model.position.y=a,p.model.position.z=n,p.model.rotation.x=r,p.model.rotation.y=o,p.model.rotation.z=i,p.model.scale.x=s,p.model.scale.y=l,p.model.scale.z=u,p.material=h,y.renderer.addDetector(p)},g="",v=0;v<m.length;v++)g=X.getVolume(d).data;return b=Y.parseData(g),p=new F(new A(b.vertices,b.normals,this.gl)),f(),e.abrupt("return",p);case 8:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r,o,i,s,l,c,u,h,d){return e.apply(this,arguments)}}()},{key:"addModel",value:function(e,t){var a=new A(e,t,this.gl);return this.renderer.addModel(a),a}},{key:"addGun",value:function(e,t,a,n,r,o,i){var s=new A(N.vertices,N.normals,this.gl);s.drawLines=!1;var l=new V(s,new E(e,t,a),new E(n,r,o),i);return l.model.position=new E(e,t,a),this.renderer.addGun(l),l}},{key:"clearSetup",value:function(){this.renderer.clearSetup()}},{key:"removeSource",value:function(e){this.renderer.removeSource(e)}},{key:"removeDetector",value:function(e){this.renderer.removeDetector(e)}},{key:"removeGun",value:function(e){this.renderer.removeGun(e)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("p",{ref:this.hint,style:{position:"fixed",bottom:"10%",left:"20%","z-index":"4",color:"white"}},this.state.hint),r.a.createElement("p",{ref:this.colorMinHint,style:{position:"fixed",bottom:"0%",left:"71%","z-index":"4",color:"white"}},this.state.colorMinHint),r.a.createElement("p",{ref:this.colorMaxHint,style:{position:"fixed",bottom:"15%",left:"71%","z-index":"4",color:"white"}},this.state.colorMaxHint),r.a.createElement("canvas",{ref:this.canvas,onMouseMove:function(t){e.move=!0,e.oldX=e.x,e.oldY=e.y,e.x=t.pageX,e.y=t.pageY},tabIndex:"0",width:"2000",height:"2000",style:{position:"fixed",right:0,left:0,width:"100%",height:"100%"},onKeyDown:function(t){e.keyDown=t.keyCode},onKeyUp:function(t){e.keyDown=" ".concat(0)},onMouseDown:function(){e.down=!0},onMouseUp:function(){e.down=!1},onWheel:function(t){var a=0;a=t.deltaY>0?1:-1,e.camera.d+=e.camera.d/(100*a)*10}}),r.a.createElement("button",{className:"camerareset",onClick:function(){e.camera=new x(45,-45,100,new E(0,0,0),new E(0,0,0))}},"reset"))}}]),a}(n.Component),Q=a(771),J=a(367),Z=a(767),$=a(768),ee=(a(27),a(772)),te=a(365),ae=a(761),ne=a(760),re=(a(224),a(764)),oe=a(765),ie=function e(){Object(h.a)(this,e)};ie.url="http://localhost:9000/",ie.get=function(){var e=Object(u.a)(c.a.mark((function e(t){var a,n,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=r.length>1&&void 0!==r[1]?r[1]:[]).push({Accept:"application/json"}),a.push({"Content-Type":"application/json"}),e.next=5,fetch(ie.url+t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"GET"});case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie.post=function(){var e=Object(u.a)(c.a.mark((function e(t,a){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(ie.url+t,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();var se=ie,le=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"get",value:function(t){for(var a=0;a<e.materials.length;a++)if(t==e.materials[a].symbol)return e.materials[a];return t}},{key:"check",value:function(t){for(var a=0;a<e.materials.length;a++)if(t==e.materials[a])return!0;return!1}},{key:"getAllElements",value:function(){}},{key:"init",value:function(){var t=Object(u.a)(c.a.mark((function t(){var a,n,r,o,i,s,l,u,h;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=0;case 1:if(void 0!=a.length){t.next=10;break}return t.next=4,se.get("elementAPI/get/All");case 4:return n=t.sent,t.next=7,n.json();case 7:a=t.sent,t.next=1;break;case 10:for(r=0;r<a.length;r++)e.materials.push({symbol:a[r].symbol,z:parseInt(a[r].z),name:a[r].name});return t.next=13,se.get("compoundAPI/get/All");case 13:return o=t.sent,t.next=16,o.json();case 16:for(i=t.sent,s=0;s<i.length;s++)e.compounds.push(i[s].name);return t.next=20,se.get("sourceAPI/get/All");case 20:return l=t.sent,t.next=23,l.json();case 23:for(u=t.sent,h=0;h<u.length;h++)e.sources.push(u[h].name);case 25:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getElement",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.get("elementAPI/get/"+t);case 2:return a=e.sent,e.next=5,a.json();case 5:e.sent;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkMaterial",value:function(t,a){for(var n=0;n<e.materials.length;n++)if(t==e.materials[n].symbol)return!0;for(var r=0;r<e.compounds.length;r++)if(t==e.compounds[r])return!0;return a(),!1}},{key:"checkSource",value:function(t,a){for(var n=0;n<e.sources.length;n++)if(t==e.sources[n])return!0;return a(),!1}}]),e}();le.sources=[],le.compounds=[],le.materials=[];var ce=le,ue=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.state={show:!1},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"showDialog",value:function(){this.setState({show:!0})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,this.props.title)),r.a.createElement(re.a.Body,null,this.props.content),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){e.hideDialog()}},"No"),r.a.createElement(te.a,{variant:"primary",onClick:function(){e.props.fun(),e.hideDialog()}},"Yes"))))}}]),a}(n.Component),he=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"convertLength",value:function(e){switch(e){case".1":return"mm";case"1":return"cm";case"10":return"dm";case"100":return"m";default:return"cm"}}},{key:"convertAngle",value:function(e){return 1==e?"rad":"deg"}},{key:"convertEnergy",value:function(e){switch(e){case"1":return"eV";case"1000":return"keV";case"1000000":return"MeV";case"1000000000":return"GeV";default:return"keV"}}}]),e}(),de=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"init",value:function(t){e.dialog=t}},{key:"showError",value:function(t,a){e.dialog.setTitle(t),e.dialog.setContent(a),e.dialog.showDialog()}}]),e}();de.dialog=null;var me=de,pe=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"init",value:function(t,a){e.showVolumeDialog=t,e.confirmDialog=a}},{key:"checkString",value:function(e){return(e=e.trim()).split('"').length%2!=0&&('"'==e[0]&&'"'==e[e.length-1])}},{key:"addDetectorCode",value:function(t,a,n,r,o,i,s,l,c,u){var h='\\Detector{\n\tname: "'+a+'";\n\tposition['+he.convertLength(l)+"]: "+n.x+", "+n.y+", "+n.z+";\n\trotation["+he.convertAngle(c)+"]: "+r.x+", "+r.y+", "+r.z+";\n\tscale["+he.convertLength(u)+"]: "+o.x+", "+o.y+", "+o.z+';\n\tmaterial: "'+i+'";\n\tgeometry: "'+s+'";\n}\n';return e.chunks.push({id:t,code:h}),h}},{key:"addSourceCode",value:function(t,a,n,r,o){var i='\\Source{\n\tname: "'+a+'";\n\tposition['+he.convertLength(o)+"]: "+n.x+", "+n.y+", "+n.z+';\n\tmaterial: "'+r+'";\n}\n';return e.chunks.push({id:t,code:i}),i}},{key:"addGunCode",value:function(t,a,n,r,o,i,s){var l='\\Gun{\n\tname: "'+a+'";\n\tposition['+he.convertLength(i)+"]: "+n.x+", "+n.y+", "+n.z+";\n\tdirection: "+r.x+", "+r.y+", "+r.z+";\n\tenergy["+he.convertEnergy(s)+"]: "+o+";\n}\n";return e.chunks.push({id:t,code:l}),l}},{key:"removeChunk",value:function(t){for(var a=" ",n=0;n<e.chunks.length;n++)if(e.chunks[n].id==t){e.chunks.splice(n,1);break}for(var r=0;r<e.chunks.length;r++)a+=e.chunks[r].code;return a}},{key:"checkFloat",value:function(e,t,a){return!isNaN(parseFloat(e.split(",")[0]))&&(!isNaN(parseFloat(e.split(",")[1]))&&(!isNaN(parseFloat(e.split(",")[2]))&&(t.x=parseFloat(e.split(",")[0])*a,t.y=parseFloat(e.split(",")[1])*a,t.z=parseFloat(e.split(",")[2])*a,!0)))}},{key:"parse",value:function(t,a,n,r,o,i){for(var s=this,l=[],c=[],u=[],h=a.gl,d=t.split("\\"),m=!1,p=[],f=function(e){var t=d[e].split("{");t[0]=t[0].replace(" ","");var a=null,n=null,r=null,o="cube";"Detector"==t[0]&&(a=new F(new A(z.vertices,z.normals,h))),"Source"==t[0]&&(n=new B(new A(z.vertices,z.normals,h),new E(0,0,0),"U235")),"Gun"==t[0]&&(r=new V(new A(z.vertices,z.normals,h),new E(0,0,0),new E(0,0,0),0));for(var i=0;i<t.length;i++)for(var f=t[i].split(";"),g=0;g<f.length;g++)if(f[g].split("(")[0].trim(),1!=f[g].split(":").length){var v=f[g].split(":")[0].trim(),b=1;switch(v.substring(v.indexOf("[")+1,v.indexOf("]"))){case"eV":b=1;break;case"keV":b=1e3;break;case"MeV":b=1e6;break;case"GeV":b=1e9;break;case"mm":b=.1;break;case"deg":b=.0174527777777778;break;case"rad":case"cm":b=1;break;case"dm":b=10;break;case"m":b=100;break;default:b=1}v.includes("[")&&(v=v.substr(0,v.indexOf("[")));var y=f[g].split(":")[1].replace(/\n/g,"");if("Detector"==t[0])switch(v){case"geometry":o=y.trim().substring(1,y.trim().length-1),a.geometry=o,void 0==X.getVolume(o)&&(m=!0,p.includes(o)||p.push(o));break;case"position":s.checkFloat(y,a.model.position,b)||me.showError("Code Error","Position incorrect format, correct format is x, y, z");break;case"rotation":s.checkFloat(y,a.model.rotation,b)||me.showError("Code Error","Rotation incorrect format, correct format is x, y, z");break;case"scale":s.checkFloat(y,a.model.scale,b)||me.showError("Code Error","Scale incorrect format, correct format is x, y, z");break;case"material":s.checkString(y)||me.showError("Code Error","Material incorrect format!"),a.material=y.trim().substring(1,y.trim().length-1),ce.checkMaterial(a.material,(function(){me.showError("Code Error","No material named: "+a.material+"\nMaterial set to Lead(Pb)!"),a.material="Pb"}));break;case"name":if(s.checkString(y)||me.showError("Code Error","Name incorrect format!"),a.name=y.trim().substring(1,y.trim().length-1),a.name.length>15)return me.showError("Code Error","Name too long!\nThe name you've given to detector "+a.name+" was too long, maximum length is 15 characters."),{v:void 0};break;default:me.showError("Code Error","No such property: "+v)}if("Source"==t[0])switch(v){case"position":s.checkFloat(y,n.model.position,b)||me.showError("Code Error","Position incorrect format, correct format is x, y, z");break;case"material":s.checkString(y)||me.showError("Code Error","Material incorrect format, correct format is x, y, z"),n.material=y.trim().substring(1,y.trim().length-1),ce.checkSource(n.material,(function(){me.showError("Code Error","No source named: "+n.material+"\nSource set to Cobalt(Co60)!"),n.material="Co60"}));break;case"name":if(s.checkString(y)||me.showError("Code Error","Name incorrect format!"),n.name=y.trim().substring(1,y.trim().length-1),n.name.length>15)return me.showError("Code Error","Name too long!\nThe name you've given to source "+n.name+" was too long, maximum length is 15 characters."),{v:void 0};break;default:me.showError("Code Error","No such property: "+v)}if("Gun"==t[0])switch(v){case"position":s.checkFloat(y,r.model.position,b)||me.showError("Code Error","Position incorrect format, correct format is x, y, z");break;case"direction":s.checkFloat(y,r.direction,b)||me.showError("Code Error","Direction incorrect format, correct format is x, y, z");break;case"energy":r.energy=parseFloat(y)*b;break;case"name":if(s.checkString(y)||me.showError("Code Error","Name incorrect format!"),r.name=y.trim().substring(1,y.trim().length-1),r.name.length>15)return me.showError("Code Error","Name too long!\nThe name you've given to gun "+r.name+" was too long, maximum length is 15 characters."),{v:void 0};break;default:me.showError("Code Error","No such property: "+v)}}null!=r&&u.push(r),null!=n&&c.push(n),null!=a&&void 0!=X.getVolume(o)&&l.push(a)},g=0;g<d.length;g++){var v=f(g);if("object"===typeof v)return v.v}m?e.confirmDialog("Volume not found!","Add the volume to the volume list before referencing it in the script then click 'Run script' again.",(function(){e.showVolumeDialog.showDialog(p,(function(){}))})):(n(),u.forEach((function(e){i(e.name,e.model.position.x,e.model.position.y,e.model.position.z,e.direction.x,e.direction.y,e.direction.z,e.energy,!1,1,1,1)})),c.forEach((function(e){o(e.name,e.model.position.x,e.model.position.y,e.model.position.z,e.material,!1,1,1,1)})),l.forEach((function(e){r(e.name,e.model.position.x,e.model.position.y,e.model.position.z,e.model.rotation.x,e.model.rotation.y,e.model.rotation.z,e.model.scale.x,e.model.scale.y,e.model.scale.z,e.material,e.geometry,X.getVolume(e.geometry).data,new E(.5,.5,.5),!1,1,1,1)})))}}]),e}();pe.showVolumeDialog=null,pe.confirmDialog=null,pe.chunks=[];var fe=pe,ge=a(366),ve=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.state={show:!1,materials:[],table:"elements",element:!0,compound:!1},n.changeTable=n.changeTable.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"changeTable",value:function(e){"elements"==e&&this.setState({element:!0,compound:!1}),"compounds"==e&&this.setState({element:!1,compound:!0}),this.setState({table:e}),this.updateMaterials("",e)}},{key:"componentDidMount",value:function(){this.updateMaterials("",this.state.table)}},{key:"showDialog",value:function(){this.setState({show:!0}),this.updateMaterials("","elements")}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"updateMaterials",value:function(e,t){var a=this;"elements"==t&&function(){for(var t=ce.materials.filter((function(t){return t.name.toUpperCase().includes(e.toUpperCase())||t.symbol.toUpperCase().includes(e.toUpperCase())})),n=[],o=Math.ceil(t.length/5),i=0;i<o;i++){for(var s=[],l=function(e){if(void 0===t[e])return"break";s.push(r.a.createElement("th",{className:"tablebutton",onClick:function(n){a.props.updatematerial(t[e].symbol),a.hideDialog()}},r.a.createElement("p",{style:{"font-size":"12px"}},t[e].z),r.a.createElement("h1",{style:{"font-size":"15px","font-weight":"bold"}},t[e].symbol),r.a.createElement("p",{style:{"font-size":"12px"}},t[e].name)))},c=Math.floor(i/o*t.length);c<Math.floor(i/o*t.length)+5;c++){if("break"===l(c))break}n.push(r.a.createElement("tr",null,s))}a.setState({materials:n})}(),"compounds"==t&&function(){for(var t=ce.compounds.filter((function(t){return t.toUpperCase().includes(e.toUpperCase())})),n=[],o=Math.ceil(t.length/3),i=0;i<o;i++){for(var s=[],l=function(e){if(void 0===t[e])return"break";s.push(r.a.createElement("th",{className:"tablebutton",onClick:function(n){a.props.updatematerial(t[e]),a.hideDialog()}},r.a.createElement("h1",{style:{"font-size":"10px","font-weight":"bold"}},t[e])))},c=Math.floor(i/o*t.length);c<Math.floor(i/o*t.length)+3;c++){if("break"===l(c))break}n.push(r.a.createElement("tr",null,s))}a.setState({materials:n})}()}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Choose a material")),r.a.createElement(re.a.Body,null,r.a.createElement(ge.a,{type:"text",onChange:function(t){e.updateMaterials(t.target.value,e.state.table)},placeholder:"Search",style:{margin:"20px",width:"200px"}}),r.a.createElement(ne.a,{style:{margin:"auto"}},r.a.createElement(te.a,{style:{"background-color":"gray",color:"white","border-radius":"0",border:"1px solid black"},disabled:this.state.element,onClick:function(){e.changeTable("elements")}},"Elements"),r.a.createElement(te.a,{style:{"background-color":"gray",color:"white","border-radius":"0",border:"1px solid black"},disabled:this.state.compound,onClick:function(){e.changeTable("compounds")}},"Compounds")),r.a.createElement(ae.a,{style:{margin:"auto"}},this.state.materials)),r.a.createElement(re.a.Footer,null)))}}]),a}(n.Component),be=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"log",value:function(e,t){se.post("log",{level:e,message:t})}},{key:"getLogs",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.get("log");case 2:return e.next=4,e.sent.text();case 4:return t=e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ye=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.confirmDialog=r.a.createRef(),n.table=r.a.createRef(),n.updateMaterial=n.updateMaterial.bind(Object(m.a)(n)),n.updateGeometry=n.updateGeometry.bind(Object(m.a)(n)),n.state={show:!1,detname:n.props.detector.name,detposx:n.props.detector.model.position.x/n.props.detector.units[0],detposy:n.props.detector.model.position.y/n.props.detector.units[0],detposz:n.props.detector.model.position.z/n.props.detector.units[0],detrotx:n.props.detector.model.rotation.x/n.props.detector.units[1],detroty:n.props.detector.model.rotation.y/n.props.detector.units[1],detrotz:n.props.detector.model.rotation.z/n.props.detector.units[1],detscalex:n.props.detector.model.scale.x/n.props.detector.units[2],detscaley:n.props.detector.model.scale.y/n.props.detector.units[2],detscalez:n.props.detector.model.scale.z/n.props.detector.units[2],detmat:n.props.detector.material,geomrty:n.props.detector.geometry,posme:n.props.detector.units[0],rotme:n.props.detector.units[1],scaleme:n.props.detector.units[2],showError:"none",modeldata:[],display:"none",filelabel:"",color:n.props.detector.model.color,options:[]},n.materials=[],n}return Object(d.a)(a,[{key:"updateMaterial",value:function(e){this.setState({detmat:e})}},{key:"hexToRgb",value:function(e){e=e.substr(1);var t=parseInt(e,16);return new E((t>>16&255)/255,(t>>8&255)/255,(255&t)/255)}},{key:"componentDidMount",value:function(){}},{key:"updateGeometry",value:function(e){this.setState({geomrty:e})}},{key:"showDialog",value:function(){var e=Object(u.a)(c.a.mark((function e(t,a){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({showError:"none",show:!0,geomrty:a.geometry}),n=t.map((function(e){return r.a.createElement("option",{value:e.name},e.name)})),this.setState({options:n});case 3:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e,t,a,n,o,i,l,h,d,m=this,p=[];return p=ce.get(this.state.detmat)==this.state.detmat?r.a.createElement("th",{className:"tablebutton",onClick:function(){m.table.current.showDialog()}},r.a.createElement("h1",{style:{"font-size":"10px","font-weight":"bold"}},this.state.detmat)):r.a.createElement("th",{className:"tablebutton",onClick:function(){m.table.current.showDialog()}},r.a.createElement("p",{style:{"font-size":"12px"}},ce.get(this.state.detmat).z),r.a.createElement("h1",{style:{"font-size":"15px","font-weight":"bold"}},ce.get(this.state.detmat).symbol),r.a.createElement("p",{style:{"font-size":"12px"}},ce.get(this.state.detmat).name)),r.a.createElement(r.a.Fragment,null,r.a.createElement(ve,{ref:this.table,updatematerial:this.updateMaterial}),r.a.createElement(ue,{ref:this.confirmDialog,title:"Confirm",content:"Are you sure you want to delete this component?",fun:function(){m.hideDialog(),m.props.removebutton(m.props.detector,m.props.button.id)}}),r.a.createElement(re.a,{show:this.state.show,onHide:function(){m.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Modify Detector")),r.a.createElement(re.a.Body,null,r.a.createElement(oe.a,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,"Name ",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,{className:"name",required:!0,type:"text",maxLength:"10",value:this.state.detname,onChange:function(e){m.setState({detname:e.target.value})}}))),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Geometry"),r.a.createElement(oe.a.Control,{as:"select",value:this.state.geomrty,onChange:function(e){m.setState({geomrty:e.target.value}),"stl"==e.target.value?m.setState({display:"block"}):m.setState({display:"none"})}},this.state.options,r.a.createElement("option",{value:"stl"},"Custom (.STL)")),r.a.createElement(oe.a.File,{style:{display:this.state.display},id:"stl-file",label:this.state.filelabel,"data-browse":"Open",custom:!0,onChange:function(e){var t=new FileReader;t.onload=function(){var e=t.result;m.setState({modeldata:e}),"STL"!==m.state.filelabel.split(".")[m.state.filelabel.split(".").length-1].toUpperCase()&&(m.setState({filelabel:"",modeldata:[]}),me.showError("Bad format","Select an .stl file!"))},t.readAsBinaryString(e.target.files[0]);var a=e.target.value;a=a.split("\\")[a.split("\\").length-1],m.setState({filelabel:a})}}),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Position"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.posme,onChange:function(e){m.setState({posme:e.target.value})}},r.a.createElement("option",{value:".1"},"mm"),r.a.createElement("option",{value:"1"},"cm"),r.a.createElement("option",{value:"10"},"dm"),r.a.createElement("option",{value:"100"},"m")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(e={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(e,"value",this.state.detposx),Object(s.a)(e,"onChange",(function(e){m.setState({detposx:e.target.value})})),e))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(t={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(t,"value",this.state.detposy),Object(s.a)(t,"onChange",(function(e){m.setState({detposy:e.target.value})})),t))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(a={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(a,"value",this.state.detposz),Object(s.a)(a,"onChange",(function(e){m.setState({detposz:e.target.value})})),a)))),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Rotation"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.rotme,onChange:function(e){m.setState({rotme:e.target.value})}},r.a.createElement("option",{value:"0.0174"},"deg"),r.a.createElement("option",{value:"1"},"rad")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(n={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(n,"value",this.state.detrotx),Object(s.a)(n,"onChange",(function(e){m.setState({detrotx:e.target.value})})),n))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(o={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(o,"value",this.state.detroty),Object(s.a)(o,"onChange",(function(e){m.setState({detroty:e.target.value})})),o))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(i={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(i,"value",this.state.detrotz),Object(s.a)(i,"onChange",(function(e){m.setState({detrotz:e.target.value})})),i)))),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Scale"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.scaleme,onChange:function(e){m.setState({scaleme:e.target.value})}},r.a.createElement("option",{value:".1"},"mm"),r.a.createElement("option",{value:"1"},"cm"),r.a.createElement("option",{value:"10"},"dm"),r.a.createElement("option",{value:"100"},"m")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(l={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(l,"value",this.state.detscalex),Object(s.a)(l,"onChange",(function(e){m.setState({detscalex:e.target.value})})),l))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(h={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(h,"value",this.state.detscaley),Object(s.a)(h,"onChange",(function(e){m.setState({detscaley:e.target.value})})),h))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(d={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(d,"value",this.state.detscalez),Object(s.a)(d,"onChange",(function(e){m.setState({detscalez:e.target.value})})),d)))),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement(ne.a,null,r.a.createElement(oe.a.Group,{controlId:"exampleForm.SelectCustom"},r.a.createElement(oe.a.Label,null,"Material"),p,r.a.createElement(te.a,{onClick:function(){m.table.current.showDialog()}},"Choose"))),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Color: ",r.a.createElement("span",{style:{"padding-left":"20px"}},r.a.createElement("input",{type:"color",onInput:function(e){m.setState({color:m.hexToRgb(e.target.value)})}})))))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){m.confirmDialog.current.showDialog()},style:{backgroundColor:"red",color:"white"}},"Delete"),r.a.createElement(te.a,{variant:"primary",onClick:Object(u.a)(c.a.mark((function e(){var t,a,n,r,o,i,s,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(be.log(3,"Modified detector"),"stl"!=m.state.geomrty){e.next=12;break}if(0!==m.state.modeldata.length){e.next=5;break}return me.showError("No file selected","Select an .stl file!"),e.abrupt("return");case 5:m.state.geomrty=m.state.detname+"Volume",t=Y.parseData(m.state.modeldata),m.props.createvolume(m.state.detname+"Volume",m.state.modeldata,m.state.detname+"Volume"),m.props.detector.model=new A(t.vertices,t.normals,m.props.canvas.current.gl),m.props.detector.model.drawLines=!1,e.next=16;break;case 12:a=X.getVolume(m.state.geomrty).data,n=Y.parseData(a),m.props.detector.model=new A(n.vertices,n.normals,m.props.canvas.current.gl),m.props.detector.model.drawLines=!1;case 16:for(m.hideDialog(),m.props.detector.name=m.state.detname,m.props.detector.model.position.x=m.state.detposx*m.state.posme,m.props.detector.model.position.y=m.state.detposy*m.state.posme,m.props.detector.model.position.z=m.state.detposz*m.state.posme,m.props.detector.model.rotation.x=m.state.detrotx*m.state.rotme,m.props.detector.model.rotation.y=m.state.detroty*m.state.rotme,m.props.detector.model.rotation.z=m.state.detrotz*m.state.rotme,m.props.detector.model.scale.x=m.state.detscalex*m.state.scaleme,m.props.detector.model.scale.y=m.state.detscaley*m.state.scaleme,m.props.detector.model.scale.z=m.state.detscalez*m.state.scaleme,m.props.detector.material=m.state.detmat,m.props.detector.model.color=m.state.color,m.props.setname(m.state.detname),r="",o=he.convertLength(m.state.posme),i=he.convertAngle(m.state.rotme),s=he.convertLength(m.state.scaleme),l=0;l<fe.chunks.length;l++)m.props.buttonid==fe.chunks[l].id&&(fe.chunks[l].code='\\Detector{\n\tname: "'+m.state.detname+'";\n\tposition['+o+"]: "+m.state.detposx+", "+m.state.detposy+", "+m.state.detposz+";\n\trotation["+i+"]: "+m.state.detrotx+", "+m.state.detroty+", "+m.state.detrotz+";\n\tscale["+s+"]: "+m.state.detscalex+", "+m.state.detscaley+", "+m.state.detscalez+';\n\tmaterial: "'+m.state.detmat+'";\n\tgeometry: "'+m.state.geomrty+'";\n}\n'),r+=fe.chunks[l].code;m.props.codeeditor.current.updateText(r),m.props.updatedetails(m.props.detector);case 37:case"end":return e.stop()}}),e)})))},"Modify"))))}}]),a}(n.Component);ye.id=0;var Ee=ye,xe=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).editdialog=r.a.createRef(),n.updateDetails=n.updateDetails.bind(Object(m.a)(n)),n.setName=n.setName.bind(Object(m.a)(n)),n.state={position:n.props.detector.model.position,rotation:n.props.detector.model.rotation,scale:n.props.detector.model.scale,deposit:n.props.detector.deposit,material:n.props.detector.material,punit:n.props.detector.units[0],runit:n.props.detector.units[1],sunit:n.props.detector.units[2],name:n.props.name},n.id=n.props.id,n.accordion=r.a.createRef(),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"updateDetails",value:function(e){this.setState({deposit:e.deposit,name:e.name,position:e.model.position,rotation:e.model.rotation,scale:e.model.scale,material:e.material,punit:e.units[0],runit:e.units[1],sunit:e.units[2]})}},{key:"updateGeometry",value:function(e){this.editdialog.updateGeometry(e)}},{key:"setName",value:function(e){this.setState({name:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(Ee,{createvolume:this.props.createvolume,setname:this.setName,canvas:this.props.canvas,name:this.props.name,buttonid:this.id,codeeditor:this.props.codeeditor,updatedetails:this.updateDetails,button:this,removebutton:this.props.removebutton,detector:this.props.detector,ref:this.editdialog,buttons:this.props.buttons,details:this.props.details}),r.a.createElement(ee.a,{className:"button"},r.a.createElement(ee.a.Header,null,r.a.createElement($.a.Toggle,{ref:this.accordion,as:te.a,onClick:function(){P.active_id!=e.props.detector.id?P.active_id=e.props.detector.id:P.active_id=-1},variant:"link",eventKey:this.id},this.state.name),r.a.createElement(te.a,{onClick:function(){e.editdialog.current.showDialog(e.props.volumes,e.props.detector)},className:"editButton"},"EDIT")),r.a.createElement($.a.Collapse,{eventKey:this.id},r.a.createElement(ee.a.Body,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Position: ")),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"x: ",this.state.position.x," ",he.convertLength(this.state.punit)),r.a.createElement(J.a,null,"y: ",this.state.position.y," ",he.convertLength(this.state.punit)),r.a.createElement(J.a,null,"z: ",this.state.position.z," ",he.convertLength(this.state.punit))),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Rotation: ")),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"x: ",this.state.rotation.x," ",he.convertAngle(this.state.runit)),r.a.createElement(J.a,null,"y: ",this.state.rotation.y," ",he.convertAngle(this.state.runit)),r.a.createElement(J.a,null,"z: ",this.state.rotation.z," ",he.convertAngle(this.state.runit))),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Scale: ")),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"x: ",this.state.scale.x," ",he.convertLength(this.state.sunit)),r.a.createElement(J.a,null,"y: ",this.state.scale.y," ",he.convertLength(this.state.sunit)),r.a.createElement(J.a,null,"z: ",this.state.scale.z," ",he.convertLength(this.state.sunit))),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Material: ")),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,this.state.material)),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Deposit: "),r.a.createElement(J.a,null,this.state.deposit," keV")))))))}}]),a}(n.Component);xe.id=0;var we=xe,ke=a(769),Ce=a(766),Se=a(770),Oe=a(762),je=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.updateMaterial=n.updateMaterial.bind(Object(m.a)(n)),n.table=r.a.createRef(),n.state={show:!1,detname:"Detector",detposx:0,detposy:0,detposz:0,detrotx:0,detroty:0,detrotz:0,detscalex:10,detscaley:10,detscalez:10,posme:1,rotme:1,scaleme:1,detmat:"Pb",geomrty:"cube",display:"none",filelabel:"Path to STL",modeldata:null,showError:"none",color:new E(.5,.5,.5),options:[]},n}return Object(d.a)(a,[{key:"updateMaterial",value:function(e){this.setState({detmat:e})}},{key:"componentDidMount",value:function(){}},{key:"hexToRgb",value:function(e){e=e.substr(1);var t=parseInt(e,16);return new E((t>>16&255)/255,(t>>8&255)/255,(255&t)/255)}},{key:"showDialog",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ce.getElement("All"),this.setState({show:!0}),a="Detector"+this.props.buttons.length,this.setState({detname:a}),this.setState({geomrty:t[0].name}),n=t.map((function(e){return r.a.createElement("option",{value:e.name},e.name)})),this.setState({options:n});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e,t,a,n,o,i,l,c,u,h=this,d=[];return d=ce.get(this.state.detmat)==this.state.detmat?r.a.createElement("th",{className:"tablebutton",onClick:function(){h.table.current.showDialog()}},r.a.createElement("h1",{style:{"font-size":"10px","font-weight":"bold"}},this.state.detmat)):r.a.createElement("th",{className:"tablebutton",onClick:function(){h.table.current.showDialog()}},r.a.createElement("p",{style:{"font-size":"12px"}},ce.get(this.state.detmat).z),r.a.createElement("h1",{style:{"font-size":"15px","font-weight":"bold"}},ce.get(this.state.detmat).symbol),r.a.createElement("p",{style:{"font-size":"12px"}},ce.get(this.state.detmat).name)),r.a.createElement(r.a.Fragment,null,r.a.createElement(ve,{ref:this.table,updatematerial:this.updateMaterial}),r.a.createElement(re.a,{show:this.state.show,onHide:function(){h.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Create detector")),r.a.createElement(re.a.Body,null,r.a.createElement(oe.a,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,"Name ",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,{className:"name",required:!0,type:"text",maxLength:"10",value:this.state.detname,onChange:function(e){h.setState({detname:e.target.value})}}))),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Geometry"),r.a.createElement(oe.a.Control,{as:"select",value:this.state.geomrty,onChange:function(e){h.setState({geomrty:e.target.value}),"stl"==e.target.value?h.setState({display:"block"}):h.setState({display:"none"})}},this.state.options,r.a.createElement("option",{value:"stl"},"Custom (.STL)")),r.a.createElement(oe.a.File,{style:{display:this.state.display},id:"stl-file",label:this.state.filelabel,"data-browse":"Open",custom:!0,onChange:function(e){var t=new FileReader;t.onload=function(){var e=t.result;h.setState({modeldata:e}),"STL"!==h.state.filelabel.split(".")[h.state.filelabel.split(".").length-1].toUpperCase()&&(h.setState({filelabel:"",modeldata:null}),me.showError("Bad format","Select an .stl file!"))},t.readAsBinaryString(e.target.files[0]);var a=e.target.value;a=a.split("\\")[a.split("\\").length-1],h.setState({filelabel:a})}}),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Position"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.posme,onChange:function(e){h.setState({posme:e.target.value})}},r.a.createElement("option",{value:".1"},"mm"),r.a.createElement("option",{value:"1"},"cm"),r.a.createElement("option",{value:"10"},"dm"),r.a.createElement("option",{value:"100"},"m")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(e={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(e,"value",this.state.detposx),Object(s.a)(e,"onChange",(function(e){h.setState({detposx:e.target.value})})),e))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(t={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(t,"value",this.state.detposy),Object(s.a)(t,"onChange",(function(e){h.setState({detposy:e.target.value})})),t))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(a={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(a,"value",this.state.detposz),Object(s.a)(a,"onChange",(function(e){h.setState({detposz:e.target.value})})),a)))),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Rotation"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.rotme,onChange:function(e){h.setState({rotme:e.target.value})}},r.a.createElement("option",{value:"0.0174"},"deg"),r.a.createElement("option",{value:"1"},"rad")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(n={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(n,"value",this.state.detrotx),Object(s.a)(n,"onChange",(function(e){h.setState({detrotx:e.target.value})})),n))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(o={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(o,"value",this.state.detroty),Object(s.a)(o,"onChange",(function(e){h.setState({detroty:e.target.value})})),o))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(i={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(i,"value",this.state.detrotz),Object(s.a)(i,"onChange",(function(e){h.setState({detrotz:e.target.value})})),i)))),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Scale"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.scaleme,onChange:function(e){h.setState({scaleme:e.target.value})}},r.a.createElement("option",{value:".1"},"mm"),r.a.createElement("option",{value:"1"},"cm"),r.a.createElement("option",{value:"10"},"dm"),r.a.createElement("option",{value:"100"},"m")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(l={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(l,"value",this.state.detscalex),Object(s.a)(l,"onChange",(function(e){h.setState({detscalex:e.target.value})})),l))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(c={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(c,"value",this.state.detscaley),Object(s.a)(c,"onChange",(function(e){h.setState({detscaley:e.target.value})})),c))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(u={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(u,"value",this.state.detscalez),Object(s.a)(u,"onChange",(function(e){h.setState({detscalez:e.target.value})})),u)))),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement(ne.a,null,r.a.createElement(oe.a.Group,{controlId:"exampleForm.SelectCustom"},r.a.createElement(oe.a.Label,null,"Material"),d,r.a.createElement(te.a,{onClick:function(){h.table.current.showDialog()}},"Choose"))),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Color: ",r.a.createElement("span",{style:{"padding-left":"20px"}},r.a.createElement("input",{type:"color",onInput:function(e){h.setState({color:h.hexToRgb(e.target.value)})}})))))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){h.hideDialog()}},"Cancel"),r.a.createElement(te.a,{variant:"primary",onClick:function(){null!==h.state.modeldata||"stl"!==h.state.geomrty?(h.hideDialog(),h.props.createbutton(h.state.detname,h.state.detposx,h.state.detposy,h.state.detposz,h.state.detrotx,h.state.detroty,h.state.detrotz,h.state.detscalex,h.state.detscaley,h.state.detscalez,h.state.detmat,h.state.geomrty,h.state.modeldata,h.state.color,!1,h.state.posme,h.state.rotme,h.state.scaleme)):me.showError("No file selected","Select an .stl file!")}},"Create"))))}}]),a}(n.Component);je.id=0;var De=je,Ae=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.confirmDialog=r.a.createRef(),n.state={show:!1,detname:n.props.detector.name,detposx:n.props.detector.model.position.x/n.props.detector.units[0],detposy:n.props.detector.model.position.y/n.props.detector.units[0],detposz:n.props.detector.model.position.z/n.props.detector.units[0],detdirx:n.props.detector.direction.x,detdiry:n.props.detector.direction.y,detdirz:n.props.detector.direction.z,posu:n.props.detector.units[0],energyu:n.props.detector.units[1],energy:n.props.detector.energy/n.props.detector.units[1]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"showDialog",value:function(){this.setState({show:!0})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e,t,a,n,o,i,l,c=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(ue,{ref:this.confirmDialog,title:"Confirm",content:"Are you sure you want to delete this component?",fun:function(){c.hideDialog(),c.props.removebutton(c.props.detector,c.props.button.id)}}),r.a.createElement(re.a,{show:this.state.show,onHide:function(){c.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Modify Gun")),r.a.createElement(re.a.Body,null,r.a.createElement(oe.a,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,"Name ",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,{className:"name",required:!0,type:"text",maxLength:"10",value:this.state.detname,onChange:function(e){c.setState({detname:e.target.value})}}))),r.a.createElement(ne.a,null,"Position"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.posu,onChange:function(e){c.setState({posu:e.target.value})}},r.a.createElement("option",{value:".1"},"mm"),r.a.createElement("option",{value:"1"},"cm"),r.a.createElement("option",{value:"10"},"dm"),r.a.createElement("option",{value:"100"},"m")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(e={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(e,"value",this.state.detposx),Object(s.a)(e,"onChange",(function(e){c.setState({detposx:e.target.value})})),e))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(t={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(t,"value",this.state.detposy),Object(s.a)(t,"onChange",(function(e){c.setState({detposy:e.target.value})})),t))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(a={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(a,"value",this.state.detposz),Object(s.a)(a,"onChange",(function(e){c.setState({detposz:e.target.value})})),a)))),r.a.createElement("br",null),r.a.createElement(ne.a,null,"Direction"),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(n={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(n,"value",this.state.detdirx),Object(s.a)(n,"onChange",(function(e){c.setState({detdirx:e.target.value})})),n))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(o={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(o,"value",this.state.detdiry),Object(s.a)(o,"onChange",(function(e){c.setState({detdiry:e.target.value})})),o))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(i={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(i,"value",this.state.detdirz),Object(s.a)(i,"onChange",(function(e){c.setState({detdirz:e.target.value})})),i)))),r.a.createElement("br",null),r.a.createElement(ne.a,null,"Energy ",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(l={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(l,"value",this.state.energy),Object(s.a)(l,"onChange",(function(e){c.setState({energy:e.target.value})})),l))),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.energyu,onChange:function(e){c.setState({energyu:e.target.value})}},r.a.createElement("option",{value:"1"},"eV"),r.a.createElement("option",{value:"1000"},"keV"),r.a.createElement("option",{value:"1000000"},"MeV"),r.a.createElement("option",{value:"1000000000"},"GeV")))))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){c.confirmDialog.current.showDialog()},style:{backgroundColor:"red",color:"white"}},"Delete"),r.a.createElement(te.a,{variant:"primary",onClick:function(){c.hideDialog(),c.props.detector.name=c.state.name,c.props.detector.model.position.x=c.state.detposx*c.state.posu,c.props.detector.model.position.y=c.state.detposy*c.state.posu,c.props.detector.model.position.z=c.state.detposz*c.state.posu,c.props.detector.direction.x=c.state.detdirx,c.props.detector.direction.y=c.state.detdiry,c.props.detector.direction.z=c.state.detdirz,c.props.detector.energy=c.state.energy*c.state.energyu;for(var e="",t=0;t<fe.chunks.length;t++)c.props.buttonid==fe.chunks[t].id&&(fe.chunks[t].code='\\Gun{\n\tname: "'+c.props.name+'";\n\tposition['+he.convertLength(c.state.posu)+"]: "+c.state.detposx+", "+c.state.detposy+", "+c.state.detposz+";\n\tdirection: "+c.state.detdirx+", "+c.state.detdiry+", "+c.state.detdirz+";\n\tenergy["+he.convertEnergy(c.state.energyu)+"]: "+c.state.energy+";\n}\n"),e+=fe.chunks[t].code;c.props.codeeditor.current.updateText(e),c.props.updatedetails(c.props.detector)}},"Modify"))))}}]),a}(n.Component);Ae.id=0;var ze=Ae,Me=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).editdialog=r.a.createRef(),n.updateDetails=n.updateDetails.bind(Object(m.a)(n)),n.state={detector:n.props.detector},n.id=n.props.id,n.accordion=r.a.createRef(),n}return Object(d.a)(a,[{key:"updateDetails",value:function(e){this.setState({detector:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(ze,{buttonid:this.id,codeeditor:this.props.codeeditor,name:this.props.name,updatedetails:this.updateDetails,button:this,removebutton:this.props.removebutton,detector:this.props.detector,ref:this.editdialog,buttons:this.props.buttons,details:this.props.details}),r.a.createElement(ee.a,{className:"button"},r.a.createElement(ee.a.Header,null,r.a.createElement($.a.Toggle,{ref:this.accordion,as:te.a,onClick:function(){P.active_id!=e.props.detector.id?P.active_id=e.props.detector.id:P.active_id=-1},variant:"link",eventKey:this.id},this.props.name),r.a.createElement(te.a,{onClick:function(){e.editdialog.current.showDialog()},className:"editButton"},"EDIT")),r.a.createElement($.a.Collapse,{eventKey:this.id},r.a.createElement(ee.a.Body,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Position: ")),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"x: ",this.state.detector.model.position.x," ",he.convertLength(this.state.detector.units[0])),r.a.createElement(J.a,null,"y: ",this.state.detector.model.position.y," ",he.convertLength(this.state.detector.units[0])),r.a.createElement(J.a,null,"z: ",this.state.detector.model.position.z," ",he.convertLength(this.state.detector.units[0]))),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Direction: ")),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"x: ",this.state.detector.direction.x," "),r.a.createElement(J.a,null,"y: ",this.state.detector.direction.y," "),r.a.createElement(J.a,null,"z: ",this.state.detector.direction.z," ")),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Energy: ",this.state.detector.energy," ",he.convertEnergy(this.state.detector.units[1]))))))))}}]),a}(n.Component);Me.id=0;var Re=Me,Te=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.state={show:!1,detname:"Gun",detposx:0,detposy:0,detposz:0,detdirx:1,detdiry:0,detdirz:0,posu:1,energyu:1e3,energy:100},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"showDialog",value:function(){this.setState({show:!0})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e,t,a,n,o,i,l,c=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){c.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Create Particle Gun")),r.a.createElement(re.a.Body,null,r.a.createElement(oe.a,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,"Name ",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,{className:"name",required:!0,type:"text",maxLength:"10",value:this.state.detname,onChange:function(e){c.setState({detname:e.target.value})}}))),r.a.createElement(ne.a,null,"Position"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.posu,onChange:function(e){c.setState({posu:e.target.value})}},r.a.createElement("option",{value:".1"},"mm"),r.a.createElement("option",{value:"1"},"cm"),r.a.createElement("option",{value:"10"},"dm"),r.a.createElement("option",{value:"100"},"m")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(e={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(e,"value",this.state.detposx),Object(s.a)(e,"onChange",(function(e){c.setState({detposx:e.target.value})})),e))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(t={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(t,"value",this.state.detposy),Object(s.a)(t,"onChange",(function(e){c.setState({detposy:e.target.value})})),t))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(a={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(a,"value",this.state.detposz),Object(s.a)(a,"onChange",(function(e){c.setState({detposz:e.target.value})})),a)))),r.a.createElement("br",null),r.a.createElement(ne.a,null,"Direction"),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(n={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(n,"value",this.state.detdirx),Object(s.a)(n,"onChange",(function(e){c.setState({detdirx:e.target.value})})),n))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(o={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(o,"value",this.state.detdiry),Object(s.a)(o,"onChange",(function(e){c.setState({detdiry:e.target.value})})),o))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(i={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(i,"value",this.state.detdirz),Object(s.a)(i,"onChange",(function(e){c.setState({detdirz:e.target.value})})),i)))),r.a.createElement("br",null),r.a.createElement(ne.a,null,"Energy ",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(l={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(l,"value",this.state.energy),Object(s.a)(l,"onChange",(function(e){c.setState({energy:e.target.value})})),l))),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.energyu,onChange:function(e){c.setState({energyu:e.target.value})}},r.a.createElement("option",{value:"1"},"eV"),r.a.createElement("option",{value:"1000"},"keV"),r.a.createElement("option",{value:"1000000"},"MeV"),r.a.createElement("option",{value:"1000000000"},"GeV")))))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){c.hideDialog()}},"Cancel"),r.a.createElement(te.a,{variant:"primary",onClick:function(){c.hideDialog(),c.props.createbutton(c.state.detname,c.state.detposx,c.state.detposy,c.state.detposz,c.state.detdirx,c.state.detdiry,c.state.detdirz,c.state.energy,!1,c.state.posu,c.state.energyu)}},"Create"))))}}]),a}(n.Component);Te.id=0;var Le=Te,Pe=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.state={show:!1,materials:[]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.updateMaterials("",this.state.table)}},{key:"showDialog",value:function(){this.updateMaterials(""),this.setState({show:!0})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"updateMaterials",value:function(e,t){for(var a=this,n=ce.sources.filter((function(t){return t.toUpperCase().includes(e.toUpperCase())})),o=[],i=Math.ceil(n.length/5),s=0;s<i;s++){for(var l=[],c=function(e){if(void 0===n[e])return"break";l.push(r.a.createElement("th",{className:"tablebutton",onClick:function(t){a.props.updatematerial(n[e]),a.hideDialog()}},r.a.createElement("h1",{style:{"font-size":"15px","font-weight":"bold"}},n[e])))},u=Math.floor(s/i*n.length);u<Math.floor(s/i*n.length)+5;u++){if("break"===c(u))break}o.push(r.a.createElement("tr",null,l))}this.setState({materials:o})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Choose a material")),r.a.createElement(re.a.Body,null,r.a.createElement(ge.a,{type:"text",onChange:function(t){e.updateMaterials(t.target.value,e.state.table)},placeholder:"Search",style:{margin:"20px",width:"200px"}}),r.a.createElement(ne.a,{style:{margin:"auto"}}),r.a.createElement(ae.a,{style:{margin:"auto"}},this.state.materials)),r.a.createElement(re.a.Footer,null)))}}]),a}(n.Component),Fe=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.updateMaterial=n.updateMaterial.bind(Object(m.a)(n)),n.confirmDialog=r.a.createRef(),n.table=r.a.createRef(),n.state={show:!1,detname:n.props.detector.name,detposx:n.props.detector.model.position.x/n.props.detector.units[0],detposy:n.props.detector.model.position.y/n.props.detector.units[0],detposz:n.props.detector.model.position.z/n.props.detector.units[0],posu:n.props.detector.units[0],material:n.props.detector.material},n}return Object(d.a)(a,[{key:"updateMaterial",value:function(e){this.setState({material:e})}},{key:"componentDidMount",value:function(){}},{key:"showDialog",value:function(){this.setState({show:!0})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e,t,a,n=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Pe,{ref:this.table,updatematerial:this.updateMaterial}),r.a.createElement(ue,{ref:this.confirmDialog,title:"Confirm",content:"Are you sure you want to delete this component?",fun:function(){n.hideDialog(),n.props.removebutton(n.props.detector,n.props.button.id)}}),r.a.createElement(re.a,{show:this.state.show,onHide:function(){n.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Modify Source")),r.a.createElement(re.a.Body,null,r.a.createElement(oe.a,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,"Name ",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,{className:"name",required:!0,type:"text",maxLength:"10",value:this.state.detname,onChange:function(e){n.setState({detname:e.target.value})}}))),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Position"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.posu,onChange:function(e){n.setState({posu:e.target.value})}},r.a.createElement("option",{value:".1"},"mm"),r.a.createElement("option",{value:"1"},"cm"),r.a.createElement("option",{value:"10"},"dm"),r.a.createElement("option",{value:"100"},"m")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(e={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(e,"value",this.state.detposx),Object(s.a)(e,"onChange",(function(e){n.setState({detposx:e.target.value})})),e))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(t={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(t,"value",this.state.detposy),Object(s.a)(t,"onChange",(function(e){n.setState({detposy:e.target.value})})),t))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(a={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(a,"value",this.state.detposz),Object(s.a)(a,"onChange",(function(e){n.setState({detposz:e.target.value})})),a)))),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement(oe.a.Group,null,"Material",r.a.createElement("th",{className:"tablebutton",onClick:function(e){n.table.current.showDialog()}},r.a.createElement("h1",{style:{"font-size":"15px","font-weight":"bold","vertical-align":"middle"}},this.state.material)))))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){n.confirmDialog.current.showDialog()},style:{backgroundColor:"red",color:"white"}},"Delete"),r.a.createElement(te.a,{variant:"primary",onClick:function(){n.hideDialog(),n.props.detector.name=n.state.name,n.props.detector.model.position.x=n.state.detposx*n.state.posu,n.props.detector.model.position.y=n.state.detposy*n.state.posu,n.props.detector.model.position.z=n.state.detposz*n.state.posu,n.props.detector.material=n.state.material;for(var e="",t=0;t<fe.chunks.length;t++)n.props.buttonid==fe.chunks[t].id&&(fe.chunks[t].code='\\Source{\n\tname: "'+n.props.name+'";\n\tposition['+he.convertLength(n.state.posu)+"]: "+n.state.detposx+", "+n.state.detposy+", "+n.state.detposz+';\n\tmaterial: "'+n.state.material+'";\n}\n'),e+=fe.chunks[t].code;n.props.codeeditor.current.updateText(e),n.props.updatedetails(n.props.detector)}},"Modify"))))}}]),a}(n.Component);Fe.id=0;var Ve=Fe,Ne=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).editdialog=r.a.createRef(),n.updateDetails=n.updateDetails.bind(Object(m.a)(n)),n.state={detector:n.props.detector},n.id=n.props.id,n.accordion=r.a.createRef(),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"updateDetails",value:function(e){this.setState({detector:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(Ve,{codeeditor:this.props.codeeditor,name:this.props.name,buttonid:this.id,updatedetails:this.updateDetails,button:this,removebutton:this.props.removebutton,detector:this.props.detector,ref:this.editdialog,buttons:this.props.buttons,details:this.props.details}),r.a.createElement(ee.a,{className:"button"},r.a.createElement(ee.a.Header,null,r.a.createElement($.a.Toggle,{ref:this.accordion,as:te.a,onClick:function(){P.active_id!=e.props.detector.id?P.active_id=e.props.detector.id:P.active_id=-1},variant:"link",eventKey:this.id},this.props.name),r.a.createElement(te.a,{onClick:function(){e.editdialog.current.showDialog()},className:"editButton"},"EDIT")),r.a.createElement($.a.Collapse,{eventKey:this.id},r.a.createElement(ee.a.Body,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Position: ")),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"x: ",this.state.detector.model.position.x," ",he.convertLength(this.state.detector.units[0])),r.a.createElement(J.a,null,"y: ",this.state.detector.model.position.y," ",he.convertLength(this.state.detector.units[0])),r.a.createElement(J.a,null,"z: ",this.state.detector.model.position.z," ",he.convertLength(this.state.detector.units[0]))),r.a.createElement(ne.a,null,r.a.createElement(J.a,null,"Material: ",this.props.detector.material)))))))}}]),a}(n.Component);Ne.id=0;var Be=Ne,Ie=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.updateMaterial=n.updateMaterial.bind(Object(m.a)(n)),n.table=r.a.createRef(),n.state={show:!1,detname:"Detector",detposx:0,detposy:0,detposz:0,posu:1,material:"Co60"},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"updateMaterial",value:function(e){this.setState({material:e})}},{key:"showDialog",value:function(){this.setState({show:!0});var e="Source"+this.props.buttons.length;this.setState({detname:e})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e,t,a,n=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Pe,{ref:this.table,updatematerial:this.updateMaterial}),r.a.createElement(re.a,{show:this.state.show,onHide:function(){n.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Create Particle Source")),r.a.createElement(re.a.Body,null,r.a.createElement(oe.a,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,null,"Name ",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,{className:"name",required:!0,type:"text",maxLength:"10",value:this.state.detname,onChange:function(e){n.setState({detname:e.target.value})}}))),r.a.createElement("hr",null),r.a.createElement(ne.a,null,"Position"),r.a.createElement(oe.a.Control,{as:"select",style:{width:"100px","margin-left":"-15px","margin-bottom":"10px"},value:this.state.posu,onChange:function(e){n.setState({posu:e.target.value})}},r.a.createElement("option",{value:".1"},"mm"),r.a.createElement("option",{value:"1"},"cm"),r.a.createElement("option",{value:"10"},"dm"),r.a.createElement("option",{value:"100"},"m")),r.a.createElement(ne.a,null,"x",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(e={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(e,"value",this.state.detposx),Object(s.a)(e,"onChange",(function(e){n.setState({detposx:e.target.value})})),e))),"y",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(t={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(t,"value",this.state.detposy),Object(s.a)(t,"onChange",(function(e){n.setState({detposy:e.target.value})})),t))),"z",r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,(a={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(a,"value",this.state.detposz),Object(s.a)(a,"onChange",(function(e){n.setState({detposz:e.target.value})})),a)))),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement(oe.a.Group,null,"Material",r.a.createElement("th",{className:"tablebutton",onClick:function(e){n.table.current.showDialog()}},r.a.createElement("h1",{style:{"font-size":"15px","font-weight":"bold","vertical-align":"middle"}},this.state.material)))))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){n.hideDialog()}},"Cancel"),r.a.createElement(te.a,{variant:"primary",onClick:function(){n.hideDialog(),n.props.createbutton(n.state.detname,n.state.detposx,n.state.detposy,n.state.detposz,n.state.material,!1,n.state.posu)}},"Create"))))}}]),a}(n.Component);Ie.id=0;var _e=Ie,Ue=a(773),He=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"login",value:function(t,a){fetch("http://localhost:9000/userAPI/login",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:t,password:a})}).then((function(e){return e.text()})).then((function(t){"Successfull login!"===t&&(e.logged_in=!0)}))}}]),e}();He.logged_in=!1,He.process_id=null;var Ge=He,qe=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={numberOfParticles:100,show:!1,loading:!1,progress:0},n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.showDialog=n.showDialog.bind(Object(m.a)(n)),n.setLoading=n.setLoading.bind(Object(m.a)(n)),n.startProgress=n.startProgress.bind(Object(m.a)(n)),n.id=0,n}return Object(d.a)(a,[{key:"hideDialog",value:function(){this.setState({show:!1}),clearInterval(this.id)}},{key:"startProgress",value:function(){var e=this;this.setState({progress:0}),this.id=setInterval((function(){se.post("gammaAPI/progress",{id:Ge.process_id}).then((function(e){return e.text()})).then((function(t){console.log(t),t.length>0&&e.setState({progress:parseInt(t)})}))}),1e3)}},{key:"showDialog",value:function(){this.setState({show:!0,loading:!1})}},{key:"setLoading",value:function(e){this.setState({loading:e})}},{key:"render",value:function(){var e=this;return this.state.loading?r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Run simulation")),r.a.createElement(re.a.Body,null,r.a.createElement(ne.a,{style:{margin:"5px"}},"Runnig simulation"),r.a.createElement(Ue.a,{now:this.state.progress,label:this.state.progress+"%"})),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){se.post("gammaAPI/cancel",{id:Ge.process_id}),e.hideDialog()}},"Cancel"),r.a.createElement(te.a,{variant:"primary",onClick:function(){e.props.runsim(e.state.numberOfParticles)}},"Run")))):r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Run simulation")),r.a.createElement(re.a.Body,null,r.a.createElement(ne.a,{style:{margin:"5px"}},"Number of particles:"),r.a.createElement(oe.a,{onSubmit:function(e){e.preventDefault()}},r.a.createElement(oe.a.Control,{required:!0,type:"number",value:this.state.numberOfParticles,onChange:function(t){t.target.value.length<6&&e.setState({numberOfParticles:t.target.value})}}))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){e.hideDialog()}},"Cancel"),r.a.createElement(te.a,{variant:"primary",onClick:function(){e.setLoading(!0),e.startProgress(),e.props.runsim(e.state.numberOfParticles,e.hideDialog)}},"Run"))))}}]),a}(n.Component),Ye=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={numberofparticles:1e3,detector:0,show:!1,loading:!1,now:60,binsize:10,progress:0},n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.showDialog=n.showDialog.bind(Object(m.a)(n)),n.setLoading=n.setLoading.bind(Object(m.a)(n)),n.startProgress=n.startProgress.bind(Object(m.a)(n)),n.id=0,n}return Object(d.a)(a,[{key:"hideDialog",value:function(){this.setState({show:!1}),clearInterval(this.id),se.post("gammaAPI/cancel",{id:Ge.process_id})}},{key:"setLoading",value:function(e){this.setState({loading:e})}},{key:"startProgress",value:function(){var e=this;this.setState({progress:0}),this.id=setInterval((function(){se.post("gammaAPI/progress",{id:Ge.process_id}).then((function(e){return e.text()})).then((function(t){console.log(t),t.length>0&&e.setState({progress:parseInt(t)})}))}),1e3)}},{key:"showDialog",value:function(){this.setState({show:!0,loading:!1})}},{key:"render",value:function(){var e,t,a=this;if(this.state.loading)return r.a.createElement(re.a,{show:this.state.show},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Configure Spectroscopy")),r.a.createElement(re.a.Body,null,r.a.createElement(ne.a,{style:{margin:"5px"}},"Runnig simulation"),r.a.createElement(Ue.a,{now:this.state.progress,label:this.state.progress+"%"})),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){a.hideDialog()}},"Cancel")));for(var n=[],o=0;o<this.props.detectors.length;o++)n.push(r.a.createElement("option",{value:this.props.detectors[o].id},this.props.detectors[o].name));return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){a.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Configure Spectroscopy")),r.a.createElement(re.a.Body,null,r.a.createElement(ne.a,{style:{margin:"5px"}},"Select detector"),r.a.createElement(oe.a,null,r.a.createElement(oe.a.Control,{as:"select",value:this.state.detector,onChange:function(e){a.setState({detector:e.target.value})}},n),r.a.createElement("hr",null),r.a.createElement(ne.a,{style:{margin:"5px"}},"Number of particles"),r.a.createElement(oe.a.Control,(e={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(e,"value",this.state.numberofparticles),Object(s.a)(e,"onChange",(function(e){a.setState({numberofparticles:e.target.value})})),e)),r.a.createElement("hr",null),r.a.createElement(ne.a,{style:{margin:"5px"}},"Bin size"),r.a.createElement(ne.a,null,r.a.createElement(oe.a.Control,(t={className:"numspinner",required:!0,value:"0",type:"number",maxLength:"10"},Object(s.a)(t,"value",this.state.binsize),Object(s.a)(t,"style",{width:"20%",margin:"15px"}),Object(s.a)(t,"onChange",(function(e){a.setState({binsize:e.target.value})})),t)),r.a.createElement("span",{style:{padding:"20px"}},"keV")))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){a.hideDialog()}},"Cancel"),r.a.createElement(te.a,{variant:"primary",onClick:function(){a.setLoading(!0),a.startProgress(),a.props.runsim(a.state.numberofparticles,a.state.detector,a.hideDialog,a.state.binsize)}},"Run"))))}}]),a}(n.Component),Ke=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.state={show:!1,name:"model",filelabel:"",modeldata:[]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"showDialog",value:function(e){this.setState({show:!0}),void 0!=e&&this.setState({name:e})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Choose a geometry")),r.a.createElement(re.a.Body,null,r.a.createElement(oe.a,null,r.a.createElement(ae.a,null,"Name",r.a.createElement(ne.a,null,r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,{className:"name",required:!0,type:"text",maxLength:"10",value:this.state.name,onChange:function(t){e.setState({name:t.target.value})}}))),r.a.createElement("hr",null),"STL File",r.a.createElement(oe.a.File,{id:"stl-file",label:this.state.filelabel,"data-browse":"Open",custom:!0,onChange:function(t){var a=new FileReader;a.onload=function(){var t=a.result;e.setState({modeldata:t}),"STL"!==e.state.filelabel.split(".")[e.state.filelabel.split(".").length-1].toUpperCase()&&(e.setState({filelabel:"",modeldata:[]}),me.showError("Bad format","Select an .stl file!"))},a.readAsBinaryString(t.target.files[0]);var n=t.target.value;n=n.split("\\")[n.split("\\").length-1],e.setState({filelabel:n})}})))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){e.hideDialog()}},"Cancel"),r.a.createElement(te.a,{variant:"primary",onClick:function(){0!=e.state.modeldata.length?(e.hideDialog(),e.props.createbutton(e.state.name,e.state.modeldata,e.state.filelabel)):me.showError("No file selected","Select an .stl file!")}},"Create"))))}}]),a}(n.Component);Ke.id=0;var Xe=Ke,We=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).dialog=r.a.createRef(),n.gundialog=r.a.createRef(),n.sourcedialog=r.a.createRef(),n.rundialog=r.a.createRef(),n.spectrumdialog=r.a.createRef(),n.confirmDialog=r.a.createRef(),n.volumedialog=r.a.createRef(),n.showRun=n.showRun.bind(Object(m.a)(n)),n.state={showTracks:!0,showParticles:!0,showAxes:!0,showGrid:!1,showrun:"none",showclearsetup:"none",showclearparticles:"none",login:window.sessionStorage.getItem("user"),projectname:n.props.projectname},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"showRun",value:function(e){e?this.setState({showrun:"block"}):this.setState({showrun:"none"})}},{key:"showClearParticles",value:function(e){e?this.setState({showclearparticles:"block"}):this.setState({showclearparticles:"none"})}},{key:"showClearSetup",value:function(e){e?this.setState({showclearsetup:"block"}):this.setState({showclearsetup:"none"})}},{key:"setProjectName",value:function(e){this.setState({projectname:e})}},{key:"render",value:function(){var e=this,t=this.state.login;return r.a.createElement(r.a.Fragment,null,r.a.createElement(ue,{ref:this.confirmDialog,title:"Confirm",content:"Are you sure you want to delete all components?",fun:function(){e.props.clearSetup(),e.showClearSetup(!1)}}),r.a.createElement(De,{ref:this.dialog,createbutton:this.props.createbutton,buttons:this.props.buttons}),r.a.createElement(Le,{ref:this.gundialog,createbutton:this.props.creategunbutton,buttons:this.props.buttons}),r.a.createElement(_e,{ref:this.sourcedialog,createbutton:this.props.createsourcebutton,buttons:this.props.buttons}),r.a.createElement(qe,{ref:this.rundialog,runsim:this.props.run}),r.a.createElement(Ye,{ref:this.spectrumdialog,runsim:this.props.runspectroscopy,detectors:this.props.detectors}),r.a.createElement(Xe,{ref:this.volumedialog,createbutton:this.props.createvolume}),r.a.createElement(ke.a,{bg:"light",variant:"light",style:{position:"fixed","z-index":"4"}},r.a.createElement(ke.a.Brand,null,this.state.projectname),r.a.createElement(te.a,{style:{display:this.state.showrun,borderRadius:0},variant:"primary",onClick:function(){e.rundialog.current.showDialog()}},"Run"),r.a.createElement(te.a,{variant:"primary",style:{backgroundColor:"green",display:this.state.showrun,borderRadius:0},onClick:function(){e.spectrumdialog.current.showDialog()}},"Spectroscopy"),r.a.createElement(te.a,{variant:"primary",style:{display:this.state.showclearparticles,backgroundColor:"red",borderRadius:0},onClick:function(){e.props.clearrun(),e.showClearParticles(!1)}},"Clear particles"),r.a.createElement(te.a,{variant:"primary",style:{display:this.state.showclearsetup,backgroundColor:"red",borderRadius:0},onClick:function(){e.confirmDialog.current.showDialog()}},"Clear setup"),r.a.createElement(te.a,{variant:"primary",style:{backgroundColor:"gray",borderRadius:0},onClick:function(){be.log(1,"asd")}},"Send log"),r.a.createElement(Z.a,{className:"mr-auto"},r.a.createElement(Ce.a,null,r.a.createElement(Ce.a.Toggle,{variant:"success",id:"dropdown-basic",style:{backgroundColor:"white",border:"none",color:"black"}},"File"),r.a.createElement(Ce.a.Menu,null,r.a.createElement(Ce.a.Item,{className:"exportoption",onClick:function(){e.props.save(e.state.projectname)}},"Export"),r.a.createElement(Ce.a.Item,{className:"importoption",onClick:function(){e.props.load()}},"Import"),r.a.createElement(Ce.a.Item,{className:"saveoption",style:void 0==t?{display:"none"}:{display:"block"},onClick:function(){e.props.updateproject()}},"Save"),r.a.createElement(Ce.a.Item,{className:"saveoption",style:void 0==t?{display:"none"}:{display:"block"},onClick:function(){e.props.saveonline()}},"Save as"))),r.a.createElement(Ce.a,null,r.a.createElement(Ce.a.Toggle,{variant:"success",id:"dropdown-basic",style:{backgroundColor:"white",border:"none",color:"black"}},"Add"),r.a.createElement(Ce.a.Menu,null,r.a.createElement(Se.a,{overlay:r.a.createElement(Oe.a,{id:"tooltip-disabled"},"Particle Detector")},r.a.createElement("span",{className:"d-inline-block"},r.a.createElement(Ce.a.Item,{className:"detectoroption",onClick:function(){e.dialog.current.showDialog(e.props.volumes)}},"Detector"))),r.a.createElement("br",null),r.a.createElement(Se.a,{overlay:r.a.createElement(Oe.a,{id:"tooltip-disabled"},"General Particle Source")},r.a.createElement("span",{className:"d-inline-block"},r.a.createElement(Ce.a.Item,{className:"detectoroption",onClick:function(){e.sourcedialog.current.showDialog()}},"GPS"))),r.a.createElement("br",null),r.a.createElement(Se.a,{overlay:r.a.createElement(Oe.a,{id:"tooltip-disabled"},"Directed Particle Gun")},r.a.createElement("span",{className:"d-inline-block"},r.a.createElement(Ce.a.Item,{className:"detectoroption",onClick:function(){e.gundialog.current.showDialog()}},"Gun"))),r.a.createElement(Se.a,{overlay:r.a.createElement(Oe.a,{id:"tooltip-disabled"},"Detector volume")},r.a.createElement("span",{className:"d-inline-block"},r.a.createElement(Ce.a.Item,{className:"detectoroption",onClick:function(){e.volumedialog.current.showDialog()}},"Volume"))))),r.a.createElement(Ce.a,null,r.a.createElement(Ce.a.Toggle,{variant:"success",id:"dropdown-basic",style:{backgroundColor:"white",border:"none",color:"black"}},"View"),r.a.createElement(Ce.a.Menu,null,r.a.createElement(oe.a.Check,{type:"checkbox",label:"Show Tracks",checked:this.state.showTracks,onChange:function(t){e.setState({showTracks:t.target.checked}),e.props.setshowtracks(e.state.showTracks)},style:{margin:"12px"}}),r.a.createElement(oe.a.Check,{type:"checkbox",label:"Show Particles",checked:this.state.showParticles,onChange:function(t){e.setState({showParticles:t.target.checked}),e.props.setshowparticles(e.state.showParticles)},style:{margin:"12px"}}),r.a.createElement(oe.a.Check,{type:"checkbox",label:"Show Axes",checked:this.state.showAxes,onChange:function(t){e.setState({showAxes:t.target.checked}),e.props.setshowaxes(e.state.showAxes)},style:{margin:"12px"}}),r.a.createElement(oe.a.Check,{type:"checkbox",label:"Show Grid",checked:this.state.showGrid,onChange:function(t){e.setState({showGrid:t.target.checked}),e.state.showGrid&&e.props.canvas.current.updateHint(" "),e.props.setshowgrid(e.state.showGrid)},style:{margin:"12px"}}))),r.a.createElement(te.a,{onClick:function(){window.location="../Dashboard"}},"Dashboard"),r.a.createElement("p",{style:void 0==t?{display:"none"}:{fontSize:"20px",display:"block",position:"absolute",right:"10%"}},"Logged in as ",t,"! "),r.a.createElement(te.a,{style:void 0==t?{display:"block",position:"absolute",right:"2%"}:{display:"none"},onClick:function(){window.location="Login"}},"Login"),r.a.createElement(te.a,{style:void 0==t?{display:"none"}:{display:"block",backgroundColor:"#ff0000",position:"absolute",right:"2%"},onClick:function(){window.sessionStorage.removeItem("user"),window.sessionStorage.removeItem("auth"),window.location="/"}},"Logout"))))}}]),a}(n.Component);We.id=0;var Qe=We,Je=function e(){Object(h.a)(this,e),this.track_id=0,this.parent_id=0,this.position=new E(0,0,0),this.color=new E(1,1,1),this.totalEnergy=0,this.energyDeposit=0,this.definition="",this.id=""},Ze=a(155),$e=a.n(Ze),et=(a(382),function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).canvas=r.a.createRef(),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.chart=new $e.a(this.canvas.current.getContext("2d"),{type:"bar",data:{labels:[],datasets:[{label:"counts",backgroundColor:"rgb(0, 99, 132)",borderColor:"rgb(0, 99, 132)",data:[]}]},options:{responsive:!0,plugins:{zoom:{pan:{enabled:!0,mode:"xy"},zoom:{enabled:!0,mode:"xy"}}}}})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("canvas",{ref:this.canvas}))}},{key:"add",value:function(e){isNaN(e)||(this.contains(e)?this.numberofenergies[this.getIndex(e)]++:(this.energies.push(e),this.numberofenergies.push(1)))}},{key:"contains",value:function(e){for(var t=0;t<this.energies.length;t++)if(this.energies[t]==e)return!0;return!1}},{key:"getIndex",value:function(e){for(var t=0;t<this.energies.length;t++)if(0==Math.abs(this.energies[t]-e))return t;return-1}},{key:"maximum",value:function(e,t){if(0==e.length)return 0;for(var a=e[0],n=0;n<e.length;n++)e[n]>a&&(a=e[n]);return a}},{key:"sort",value:function(e){var t=[],a=this.maximum(this.energies);alert(e);for(var n=0;n<a+2*e;n+=parseInt(e))this.add(n);for(var r=0;r<this.energies.length;r++)t.push({hit:this.energies[r],no:this.numberofenergies[r]});t.sort((function(e,t){return e.hit<t.hit?-1:e.hit==t.hit?0:1}));for(var o=0;o<t.length;o++)this.energies[o]=t[o].hit,this.numberofenergies[o]=t[o].no;for(var i=0;i<this.energies.length;i++)this.addData(parseInt(this.energies[i]),this.numberofenergies[i]-1);this.chart.update()}},{key:"clear",value:function(e){this.energies=[],this.numberofenergies=[],this.chart.data.labels=[],this.chart.data.datasets=[],this.chart.destroy();var t=this.canvas.current.getContext("2d");this.chart=new $e.a(t,{type:"bar",data:{labels:[],datasets:[{label:"counts",backgroundColor:"rgb(0, 99, 132)",borderColor:"rgb(0, 99, 132)",data:[]}]},options:{responsive:!0,scales:{yAxes:[{scaleLabel:{display:!0,fontSize:18,fontColor:"#000",labelString:"Number of hits"}}],xAxes:[{scaleLabel:{display:!0,fontSize:18,fontColor:"#000",labelString:"Energies (keV)"}}]},plugins:{zoom:{pan:{enabled:!0,mode:"x"},zoom:{enabled:!0,mode:"x"}}}}})}},{key:"addData",value:function(e,t){this.chart.data.labels.push(e),this.chart.data.datasets.forEach((function(e){e.data.push(t)}))}}],[{key:"save",value:function(){}}]),a}(n.Component)),tt=a(368),at=a.n(tt),nt=(a(391),a(392),a(222)),rt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).fileinput=r.a.createRef(),n.updateText=n.updateText.bind(Object(m.a)(n)),n.state={text:"",width:"20%"},n.editor=r.a.createRef(),n.onclickfunction=function(){var e=n.state.text;fe.parse(e,n.props.canvas.current,n.props.clearSetup,n.props.createDetector,n.props.createSource,n.props.createGun),n.setState({text:e}),be.log(2,"Ran script: "+n.state.text)},n}return Object(d.a)(a,[{key:"run",value:function(){this.onclickfunction()}},{key:"addDetectorCode",value:function(e,t,a,n,r,o,i,s,l,c,u){var h=this.state.text;this.setState({text:h+fe.addDetectorCode(e,t,a,n,r,o,i,s,l,c)}),fe.chunks.pop()}},{key:"addSourceCode",value:function(e,t,a,n){var r=this.state.text;this.setState({text:r+'\\Source{\n\tname: "'+e+'";\n\tposition['+he.convertLength(n)+"]: "+t.x+", "+t.y+", "+t.z+';\n\tmaterial: "'+a+'";\n}\n'})}},{key:"addGunCode",value:function(e,t,a,n,r,o){var i=this.state.text;this.setState({text:i+'\\Gun{\n\tname: "'+e+'";\n\tposition['+he.convertLength(r)+"]: "+t.x+", "+t.y+", "+t.z+";\n\tdirection: "+a.x+", "+a.y+", "+a.z+";\n\tenergy["+he.convertEnergy(o)+"]: "+n+";\n}\n"})}},{key:"componentDidMount",value:function(){}},{key:"updateText",value:function(e){this.setState({text:e})}},{key:"renameGeometry",value:function(e,t,a){for(var n=0;n<a.length;n++)if(a[n].geometry==e){var r=fe.removeChunk(a[n].id);this.updateText(r),this.setState({text:r+fe.addDetectorCode(a[n].id,a[n].name,a[n].model.position,a[n].model.rotation,a[n].model.scale,a[n].material,t,a[n].units[0],a[n].units[1],a[n].units[2])})}}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{width:this.state.width,height:"100%",top:"50px",position:"fixed",right:"0","z-index":"3",border:"0",borderRadius:"0",padding:"0",margin:"0","background-color":"white"}},r.a.createElement(te.a,{style:Object(s.a)({border:"0",position:"relative","background-color":"gray","z-index":"3",bottom:"0","border-radius":"0"},"border","solid 1px white"),onClick:function(){e.setState({text:"Write your code here"})}},"New"),r.a.createElement("input",{ref:this.fileinput,type:"file",style:{display:"none"},onChange:function(t){var a=new FileReader;a.onload=function(){var t=a.result;e.updateText(t)},a.readAsBinaryString(t.target.files[0])}}),r.a.createElement(te.a,{style:Object(s.a)({border:"0",position:"relative","background-color":"gray","z-index":"3",bottom:"0","border-radius":"0"},"border","solid 1px white"),onClick:function(){e.fileinput.current.click()}},"Open"),r.a.createElement(te.a,{onClick:this.onclickfunction,style:Object(s.a)({border:"0",position:"relative","background-color":"gray","z-index":"3",bottom:"0","border-radius":"0"},"border","solid 1px white")},"Run script"),r.a.createElement(te.a,{style:Object(s.a)({border:"0",position:"relative","background-color":"gray","z-index":"3",bottom:"0","border-radius":"0"},"border","solid 1px white"),onClick:function(){window.location="Help"}},"Help"),r.a.createElement(at.a,{style:{"z-index":"2",width:"100%"},ref:this.editor,value:this.state.text,mode:"elixir",theme:"monokai",fontSize:16,onChange:function(t){e.setState({text:t})}}),r.a.createElement(te.a,{onClick:function(){"20%"==e.state.width?e.setState({width:"0"}):e.setState({width:"20%"})},style:{right:this.state.width,position:"fixed",top:"50%","z-index":"3",height:"50px","background-color":"gray",border:"0"}}),r.a.createElement("div",{style:{position:"fixed","z-index":"1","background-color":"black",height:"100%",top:"0",width:this.state.width}}))}}]),a}(n.Component),ot=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.updateCanvas=n.updateCanvas.bind(Object(m.a)(n)),n.state={show:!1},n.canvas=r.a.createRef(),n.camera=new x(45,-45,10,new E(0,0,0),new E(0,0,0)),n.oldX=0,n.oldY=0,n.move=!1,n.x=0,n.y=0,n.keyDown=" ".concat(0),n.down=!1,n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"updateCanvas",value:function(){var e=this;this.gl=this.canvas.current.getContext("webgl2"),this.renderer=new P(this.gl),this.renderer=new P(this.gl),this.renderer.drawAxes=!1;var t=new A(this.props.modeldata.vertices,this.props.modeldata.normals,this.gl);t.drawLines=!1,t.color=new E(.8,.8,.8),this.renderer.addDetector(new F(t)),this.renderer.models=[];requestAnimationFrame((function t(){if(0!=e.state.show){e.gl.clearColor(.1,1,.1,1),e.gl.clear(e.gl.COLOR_BUFFER_BIT);var a,n=w.createProjectionMatrix(70,.1*e.camera.d,1e3*e.camera.d,e.canvas.current.offsetWidth,e.canvas.current.offsetHeight);e.down&&e.move&&(17===e.keyDown?(e.camera.a.y-=.01*e.getMouseYd()*e.camera.d*((89-Math.abs(e.camera.y))/89)*.01,e.camera.a.x-=Math.cos(e.camera.x/(180/Math.PI))*e.getMouseXd()*.01*e.camera.d*((89-Math.abs(e.camera.y))/89)*.01,e.camera.a.z+=Math.sin(e.camera.x/(180/Math.PI))*e.getMouseXd()*.01*e.camera.d*((89-Math.abs(e.camera.y))/89)*.01,e.camera.a.x-=.01*(Math.cos(e.camera.x/(180/Math.PI))*e.getMouseXd()*.01*e.camera.d+Math.sin(e.camera.x/(180/Math.PI))*e.getMouseYd()*.01*e.camera.d),e.camera.a.z-=.01*(Math.cos(e.camera.x/(180/Math.PI))*e.getMouseYd()*.01*e.camera.d+Math.sin(e.camera.x/(180/Math.PI))*-e.getMouseXd()*.01*e.camera.d)):(e.camera.x+=e.getMouseXd()/2,e.camera.y+=e.getMouseYd()/2)),(a=e.camera).y>89&&(a.y=89),a.y<-89&&(a.y=-89),a.p.x=a.d*-Math.sin(a.x*Math.PI/180)*Math.cos(a.y*Math.PI/180)+a.a.x,a.p.y=a.d*-Math.sin(a.y*Math.PI/180)+a.a.y,a.p.z=-a.d*Math.cos(a.x*Math.PI/180)*Math.cos(a.y*Math.PI/180)+a.a.z,e.renderer.draw(n,e.camera),requestAnimationFrame(t)}}))}},{key:"showDialog",value:function(){this.setState({show:!0})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"getMouseXd",value:function(){return this.oldX-this.x}},{key:"getMouseYd",value:function(){return this.oldY-this.y}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()},onShow:this.updateCanvas},r.a.createElement("canvas",{ref:this.canvas,width:"2000",height:"2000",style:{width:"600px",height:"600px"},onKeyDown:function(t){e.keyDown=t.keyCode},onKeyUp:function(t){e.keyDown=" ".concat(0)},onMouseMove:function(t){e.move=!0,e.oldX=e.x,e.oldY=e.y,e.x=t.pageX,e.y=t.pageY},onMouseDown:function(){e.down=!0},onMouseUp:function(){e.down=!1},onWheel:function(t){var a=0;a=t.deltaY>0?1:-1,e.camera.d+=e.camera.d/(100*a)*10}})))}}]),a}(n.Component),it=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.state={show:!1,name:n.props.name,filelabel:n.props.filelabel,modeldata:n.props.modeldata},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"showDialog",value:function(){var e=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({show:!0});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Modify geometry")),r.a.createElement(re.a.Body,null,r.a.createElement(oe.a,null,r.a.createElement(ae.a,null,"Name",r.a.createElement(ne.a,null,r.a.createElement(J.a,null,r.a.createElement(oe.a.Control,{className:"name",required:!0,type:"text",maxLength:"10",value:this.state.name,onChange:function(t){e.setState({name:t.target.value})}}))),r.a.createElement("hr",null),"STL File",r.a.createElement(oe.a.File,{id:"stl-file",label:this.state.filelabel,"data-browse":"Open",custom:!0,onChange:function(t){var a=new FileReader;a.onload=function(){var t=a.result;e.setState({modeldata:t})},a.readAsBinaryString(t.target.files[0]);var n=t.target.value;n=n.split("\\")[n.split("\\").length-1],e.setState({filelabel:n})}})))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){e.hideDialog()}},"Cancel"),r.a.createElement(te.a,{variant:"primary",onClick:function(){0!=e.state.modeldata.length?(e.hideDialog(),X.updateVolume(e.props.volume.name,e.state.name,e.state.data,e.props.detectors),e.props.volume.name=e.state.name,e.props.setname(e.state.name),e.props.volume.data=e.state.modeldata):alert("Select an stl file!")}},"Modify"))))}}]),a}(n.Component),st=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).editdialog=r.a.createRef(),n.updateDetails=n.updateDetails.bind(Object(m.a)(n)),n.setName=n.setName.bind(Object(m.a)(n)),n.state={details:n.props.details,name:n.props.name},n.canvas=r.a.createRef(),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"updateDetails",value:function(e){this.setState({details:e})}},{key:"setName",value:function(e){this.setState({name:e})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(ot,{modeldata:this.props.modeldata,ref:this.canvas}),r.a.createElement(it,{detectors:this.props.detectors,setname:this.setName,ref:this.editdialog,volume:this.props.volume,name:this.props.name,modeldata:this.props.modeldata,filelabel:this.props.filelabel}),r.a.createElement(ee.a,{className:"button"},r.a.createElement(ee.a.Header,null,r.a.createElement($.a.Toggle,{as:te.a,variant:"link",eventKey:this.id,onClick:function(){e.canvas.current.showDialog()}},this.state.name),r.a.createElement(te.a,{onClick:function(){e.editdialog.current.showDialog()},className:"editButton"},"EDIT"))))}}]),a}(n.Component);st.id=0;var lt=st,ct=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.state={show:!1,title:"",content:"",fun:null,arg:null},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"showDialog",value:function(e,t,a,n){this.setState({title:e,content:t,fun:a,arg:n}),this.setState({show:!0})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,this.state.title)),r.a.createElement(re.a.Body,null,this.state.content),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"primary",onClick:function(){e.state.fun(e.state.arg),e.hideDialog()}},"OK"))))}}]),a}(n.Component),ut=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.addVolume=n.addVolume.bind(Object(m.a)(n)),n.removeVolume=n.removeVolume.bind(Object(m.a)(n)),n.state={show:!1,volumes:[],fixed:[],showConfirm:"none",fun:null},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"updateVolume",value:function(e,t){for(var a=this.state.fixed,n=0;n<this.state.fixed.length;n++)this.state.fixed[n].volume==e&&(a[n].label=t);this.setState({fixed:a})}},{key:"removeVolume",value:function(e){for(var t=this.state.volumes,a=0;a<this.state.volumes.length;a++)this.state.volumes[a]==e&&t.splice(a,1);this.setState({volumes:t})}},{key:"addVolume",value:function(e,t,a){var n=this.state.fixed;n.push({volume:e,label:t,data:a}),this.setState({fixed:n}),0==this.state.volumes.length&&this.setState({showConfirm:"block"})}},{key:"showDialog",value:function(e,t){this.setState({show:!0,fun:t}),this.setState({volumes:e,fixed:[],showConfirm:"none"})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e=this,t=this.state.volumes.map((function(t){return r.a.createElement(r.a.Fragment,null,r.a.createElement(ne.a,{style:{padding:"10px",border:"solid 1px black"}},r.a.createElement(J.a,null,t),r.a.createElement(J.a,null,r.a.createElement(oe.a.File,{id:"stl-file","data-browse":"Open",label:"",custom:!0,onChange:function(a){var n=new FileReader;n.onload=function(){var a=n.result;e.addVolume(t,r,a)},n.readAsBinaryString(a.target.files[0]);var r=a.target.value;r=r.split("\\")[r.split("\\").length-1],e.setState({filelabel:r}),e.removeVolume(t)}}))))})),a=this.state.fixed.map((function(t,a){return r.a.createElement(r.a.Fragment,null,r.a.createElement(ne.a,{style:{padding:"10px",border:"solid 1px black"}},r.a.createElement(J.a,null,t.volume),r.a.createElement(J.a,null,r.a.createElement(oe.a.File,{id:"stl-file","data-browse":"Open",label:t.label,custom:!0,onChange:function(a){var n=new FileReader;n.onload=function(){var t=n.result;e.setState({modeldata:t})},n.readAsBinaryString(a.target.files[0]);var r=a.target.value;r=r.split("\\")[r.split("\\").length-1],e.setState({filelabel:r}),e.updateVolume(t.volume,r)}}))))}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Choose a geometry")),r.a.createElement(re.a.Body,null,r.a.createElement(oe.a,null,r.a.createElement(ae.a,null,"Missing volumes",t,r.a.createElement("hr",null),"Fixed volumes",a))),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){e.hideDialog()}},"Cancel"),r.a.createElement(te.a,{style:{display:this.state.showConfirm},variant:"primary",onClick:function(){if(0==e.state.volumes){e.hideDialog();for(var t=0;t<e.state.fixed.length;t++)e.props.createbutton(e.state.fixed[t].volume,e.state.fixed[t].data);e.state.fun()}else alert("Select an stl file!")}},"OK"))))}}]),a}(n.Component);ut.id=0;var ht=ut,dt=(a(393),n.Component,a(369)),mt=a.n(dt),pt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).state={show:!1},n}return Object(d.a)(a,[{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"showDialog",value:function(){this.setState({show:!0})}},{key:"render",value:function(){var e=this;return r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Run simulation")),r.a.createElement(re.a.Body,null,r.a.createElement(mt.a,{graph:{nodes:[{id:1,label:"Node 1",title:"node 1 tootip text"},{id:2,label:"Node 2",title:"node 2 tootip text"},{id:3,label:"Node 3",title:"node 3 tootip text"},{id:4,label:"Node 4",title:"node 4 tootip text"},{id:5,label:"Node 5",title:"node 5 tootip text"}],edges:[{from:1,to:2},{from:1,to:3},{from:2,to:4},{from:2,to:5}]},options:{layout:{hierarchical:!0},edges:{color:"#000000"},height:"500px"},events:{select:function(e){e.nodes,e.edges}},getNetwork:function(e){}})))}}]),a}(n.Component),ft=(a(532),a(221)),gt=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"update",value:function(){var e=Object(u.a)(c.a.mark((function e(t,a,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=new ft).file("signature","Created at radsim.inf.elte.hu"),r.file("script.txt",a),r.folder("volumes"),n.forEach((function(e){r.file("volumes/"+e.name+".stl",e.data,{binary:!0})})),r.generateAsync({type:"base64"}).then(function(){var e=Object(u.a)(c.a.mark((function e(a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:se.post("projectAPI/update",{id:t,data:a});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 6:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"loadonline",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var a,n,r,o,i,s,l,u,h,d,m;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,se.get("projectAPI/get/"+t);case 3:return n=e.sent,e.next=6,n.json();case 6:r=e.sent,o=0;case 8:if(!(o<r.length)){e.next=30;break}return i=new ft,s=r[o].data,e.next=13,i.loadAsync(s,{base64:!0});case 13:l=e.sent,u=0;case 15:if(!(u<Object.keys(l.files).length)){e.next=27;break}if(void 0!=i.file(Object.keys(l.files)[u])){e.next=18;break}return e.abrupt("continue",24);case 18:return e.next=20,i.file(Object.keys(l.files)[u]).async("uint8array");case 20:for(h=e.sent,d="",m=0;m<h.length;m++)d+=String.fromCharCode(h[m]);a.push({name:Object.keys(l.files)[u],content:d});case 24:u++,e.next=15;break;case 27:o++,e.next=8;break;case 30:return e.abrupt("return",[r[0].name,a]);case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveonline",value:function(e,t,a){var n=new ft;n.file("signature","Created at radsim.inf.elte.hu"),n.file("script.txt",e),n.folder("volumes"),t.forEach((function(e){n.file("volumes/"+e.name+".stl",e.data,{binary:!0})})),n.generateAsync({type:"base64"}).then(function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:se.post("projectAPI/add",{name:a,data:t,user:window.sessionStorage.getItem("user")});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"save",value:function(e,t,n){var r=new(a(221));r.file("signature","Created at radsim.inf.elte.hu"),r.file("script.txt",e),r.folder("volumes"),t.forEach((function(e){r.file("volumes/"+e.name+".stl",e.data,{binary:!0})})),r.generateAsync({type:"blob"}).then((function(e){Object(nt.saveAs)(e,"name.zip")}))}},{key:"load",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r,o,i,s,l,u,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r=a(221),o=new r,e.next=5,o.loadAsync(t);case 5:i=e.sent,s=0;case 7:if(!(s<Object.keys(i.files).length)){e.next=19;break}if(void 0!=o.file(Object.keys(i.files)[s])){e.next=10;break}return e.abrupt("continue",16);case 10:return e.next=12,o.file(Object.keys(i.files)[s]).async("uint8array");case 12:for(l=e.sent,u="",h=0;h<l.length;h++)u+=String.fromCharCode(l[h]);n.push({name:Object.keys(i.files)[s],content:u});case 16:s++,e.next=7;break;case 19:return e.abrupt("return",n);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),vt=a(763),bt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.state={show:!1,content:n.props.content,title:n.props.title},n.setTitle=n.setTitle.bind(Object(m.a)(n)),n.setContent=n.setContent.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"setTitle",value:function(e){this.setState({title:e})}},{key:"setContent",value:function(e){this.setState({content:e})}},{key:"showDialog",value:function(){this.setState({show:!0})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,this.state.title)),r.a.createElement(re.a.Body,null,r.a.createElement(J.a,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,{className:"justify-content-md-center"},r.a.createElement(vt.a,{color:"red",size:48})),r.a.createElement(ne.a,{className:"justify-content-md-center"},this.state.content))),r.a.createElement(J.a,null)),r.a.createElement(re.a.Footer,null,r.a.createElement(ae.a,null,r.a.createElement(ne.a,{className:"justify-content-md-center"},r.a.createElement(te.a,{variant:"primary",onClick:function(){e.hideDialog()}},"OK"))))))}}]),a}(n.Component),yt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).showDialog=n.showDialog.bind(Object(m.a)(n)),n.hideDialog=n.hideDialog.bind(Object(m.a)(n)),n.state={show:!1,name:"Untitled"},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"showDialog",value:function(){this.setState({show:!0})}},{key:"hideDialog",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(re.a,{show:this.state.show,onHide:function(){e.hideDialog()}},r.a.createElement(re.a.Header,{closeButton:!0},r.a.createElement(re.a.Title,null,"Save as")),r.a.createElement(re.a.Body,null,"Project name: ",r.a.createElement("input",{type:"text",className:"saveName",value:this.state.name,onChange:function(t){e.setState({name:t.target.value})}})),r.a.createElement(re.a.Footer,null,r.a.createElement(te.a,{variant:"secondary",onClick:function(){e.hideDialog()}},"Cancel"),r.a.createElement(te.a,{variant:"primary",onClick:function(){e.props.saveonline(e.state.name),e.hideDialog()}},"OK"))))}}]),a}(n.Component),Et=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"get",value:function(e){var t=window.location.search;return new URLSearchParams(t).get(e)}}]),e}(),xt=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).spectrum=r.a.createRef(),n.navbar=r.a.createRef(),n.codeeditor=r.a.createRef(),n.volumedialog=r.a.createRef(),n.popup=r.a.createRef(),n.volumeselect=r.a.createRef(),n.graphdialog=r.a.createRef(),n.loadfile=r.a.createRef(),n.errordialog=r.a.createRef(),n.confirmdialog=r.a.createRef(),n.state={buttons:[],gunbuttons:[],sourcebuttons:[],volumebuttons:[],spectrum:!0,page:"first",volumebuttonheight:"100%"},n.createDetector=n.createDetector.bind(Object(m.a)(n)),n.createSource=n.createSource.bind(Object(m.a)(n)),n.createGun=n.createGun.bind(Object(m.a)(n)),n.createVolume=n.createVolume.bind(Object(m.a)(n)),n.removeDetector=n.removeDetector.bind(Object(m.a)(n)),n.removeGun=n.removeGun.bind(Object(m.a)(n)),n.removeSource=n.removeSource.bind(Object(m.a)(n)),n.runSim=n.runSim.bind(Object(m.a)(n)),n.runSpectroscopy=n.runSpectroscopy.bind(Object(m.a)(n)),n.setShowParticles=n.setShowParticles.bind(Object(m.a)(n)),n.setShowTracks=n.setShowTracks.bind(Object(m.a)(n)),n.setShowAxes=n.setShowAxes.bind(Object(m.a)(n)),n.setShowGrid=n.setShowGrid.bind(Object(m.a)(n)),n.clearRun=n.clearRun.bind(Object(m.a)(n)),n.clearSetup=n.clearSetup.bind(Object(m.a)(n)),n.save=n.save.bind(Object(m.a)(n)),n.load=n.load.bind(Object(m.a)(n)),n.saveOnline=n.saveOnline.bind(Object(m.a)(n)),n.showSaveDialog=n.showSaveDialog.bind(Object(m.a)(n)),n.updateProject=n.updateProject.bind(Object(m.a)(n)),n.accordion=r.a.createRef(),n.canvas=r.a.createRef(),n.detectors=[],n.guns=[],n.sources=[],n.particles=[],n.tracks=[],n.volumes=[],n}return Object(d.a)(a,[{key:"checkRunnable",value:function(){this.navbar.current.showRun(this.detectors.length>0&&this.sources.length>0||this.detectors.length>0&&this.guns.length>0)}},{key:"clearRun",value:function(){this.canvas.current.clearRun(),this.canvas.current.updateColorHint("0 keV","0 keV")}},{key:"runSpectroscopy",value:function(e,t,a,n){be.log(1,"Started spectrum simulation");var r=[];r.push(0),r.push(1),r.push(0),r.push(0),r.push(0),r.push(0),r.push(0),r.push(0),r.push(0);var o=this.detectors.length;r.push(o);for(var i=0;i<o;i++){r.push("G4_"+this.detectors[i].material),r.push(this.detectors[i].id),r.push(this.detectors[i].model.position.x),r.push(this.detectors[i].model.position.y),r.push(this.detectors[i].model.position.z),r.push(this.detectors[i].model.rotation.x),r.push(this.detectors[i].model.rotation.y),r.push(this.detectors[i].model.rotation.z),r.push(this.detectors[i].model.scale.x),r.push(this.detectors[i].model.scale.y),r.push(this.detectors[i].model.scale.z),r.push(this.detectors[i].model.vertices.length);for(var s=0;s<this.detectors[i].model.vertices.length;s++)r.push(this.detectors[i].model.vertices[s])}var l=this.sources.length;r.push(l);for(i=0;i<l;i++)r.push(this.sources[i].material),r.push(this.sources[i].model.position.x),r.push(this.sources[i].model.position.y),r.push(this.sources[i].model.position.z);var c=this.guns.length;r.push(c);for(i=0;i<c;i++)r.push(this.guns[i].model.position.x),r.push(this.guns[i].model.position.y),r.push(this.guns[i].model.position.z),r.push(this.guns[i].direction.x),r.push(this.guns[i].direction.y),r.push(this.guns[i].direction.z),r.push(this.guns[i].energy);r.push(this.detectors[t].id),r.push(e),r.push("end"),this.sendGamma(r,a,n)}},{key:"runSim",value:function(e,t){this.clearRun(),be.log(1,"Started simulation");var a=[];a.push(1),a.push(1),a.push(0),a.push(0),a.push(0),a.push(0),a.push(0),a.push(0),a.push(0);var n=this.detectors.length;a.push(n);for(var r=0;r<n;r++){a.push("G4_"+this.detectors[r].material),a.push(this.detectors[r].id),a.push(this.detectors[r].model.position.x),a.push(this.detectors[r].model.position.y),a.push(this.detectors[r].model.position.z),a.push(this.detectors[r].model.rotation.x),a.push(this.detectors[r].model.rotation.y),a.push(this.detectors[r].model.rotation.z),a.push(this.detectors[r].model.scale.x),a.push(this.detectors[r].model.scale.y),a.push(this.detectors[r].model.scale.z),a.push(this.detectors[r].model.vertices.length);for(var o=0;o<this.detectors[r].model.vertices.length;o++)a.push(this.detectors[r].model.vertices[o])}var i=this.sources.length;a.push(i);for(r=0;r<i;r++)a.push(this.sources[r].material),a.push(this.sources[r].model.position.x),a.push(this.sources[r].model.position.y),a.push(this.sources[r].model.position.z);var s=this.guns.length;a.push(s);for(r=0;r<s;r++)a.push(this.guns[r].model.position.x),a.push(this.guns[r].model.position.y),a.push(this.guns[r].model.position.z),a.push(this.guns[r].direction.x),a.push(this.guns[r].direction.y),a.push(this.guns[r].direction.z),a.push(this.guns[r].energy);a.push(e),a.push("end"),this.send(a,t)}},{key:"sendGamma",value:function(){var e=Object(u.a)(c.a.mark((function e(t,a,n){var r,o,i,s=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r="",o=0;o<t.length;o++)r+=t[o],r+=",";return e.next=4,se.get("gammaAPI/getid");case 4:return i=e.sent,e.next=7,i.json();case 7:Ge.process_id=e.sent,se.post("gammaAPI",{data:r}).then((function(e){return e.text()})).then((function(e){s.processGammaSpectrum(e,n),a(),s.setState({spectrum:!1,page:"second"}),be.log(1,"Finished spectrum simulation")}));case 9:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=Object(u.a)(c.a.mark((function e(t,a){var n,r,o,i=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n="",r=0;r<t.length;r++)n+=t[r],n+=",";return e.next=4,se.get("gammaAPI/getid");case 4:return o=e.sent,e.next=7,o.json();case 7:Ge.process_id=e.sent,se.post("gammaAPI",{data:n}).then((function(e){return e.text()})).then((function(e){i.processResponse(e),a(),be.log(1,"Finished simulation")}));case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"processGammaSpectrum",value:function(e,t){var a=e;a=a.split(" "),this.spectrum.current.clear(t);for(var n=0;n<a.length;n++)this.spectrum.current.add(Math.floor(parseFloat(a[n])/t)*t);this.spectrum.current.sort(t)}},{key:"processResponse",value:function(e){var t=this,a=e.split(" "),n=0,r=0;for(this.particles=[];n<a.length-1-this.detectors.length-1;){var o=[],i=parseInt(a[n]);if(0==i)break;for(var s=a[n+1],l=0;l<i;l++){var c=new Je;c.position.x=.1*parseFloat(a[n+7*l+2]),c.position.y=.1*parseFloat(a[n+7*l+3]),c.position.z=.1*parseFloat(a[n+7*l+4]),o.push(.1*parseFloat(a[n+7*l+2])),o.push(.1*parseFloat(a[n+7*l+3])),o.push(.1*parseFloat(a[n+7*l+4])),c.definition=s,c.track_id=parseInt(a[n+7*l+5]),c.parent_id=parseInt(a[n+7*l+6]),c.totalEnergy=parseFloat(a[n+7*l+7]),c.energyDeposit=parseFloat(a[n+7*l+8]),c.color=new E(1,0,0),c.id=r,r++,l>0&&this.particles.push(c)}n+=7*i+2;for(var u=[],h=0;h<o.length;h++)u.push(1);var d=this.canvas.current.addModel(o,u);d.color=new E(1,0,0),"e-"==s&&(d.color=new E(1,0,1)),"gamma"==s&&(d.color=new E(1,1,1)),"e+"==s&&(d.color=new E(1,1,0)),d.drawLines=!0,this.tracks.push(d)}var m=[];for(l=0;l<this.particles.length;l++)m.push(this.particles[l]);this.particles=m.slice();var p=function(e){for(var t=0,a=0;a<e.length;a++)e[a].energyDeposit>t&&(t=e[a].energyDeposit);return t}(this.particles),f=function(e){for(var t=0,a=0;a<e.length;a++)e[a].energyDeposit<=p&&(t=e[a].energyDeposit);return t}(this.particles);this.canvas.current.updateColorHint(Math.ceil(1e3*p)+" keV",Math.ceil(1e3*f)+" keV"),this.canvas.current.instanceRenderer.maxenergy=p;for(var g=0;g<this.particles.length;g++){this.particles[g].color.x=this.particles[g].energyDeposit;var v=Math.sqrt(this.particles[g].color.x/p);this.particles[g].scale=new E(.03*v,.03*v,.03*v),this.canvas.current.addParticle(this.particles[g])}this.particles.length>0&&this.navbar.current.showClearParticles(!0);var b=a.length-this.detectors.length-1;this.detectors.forEach((function(e){e.deposit=parseFloat(a[b]),b++,t.canvas.current.detector_buttons.forEach((function(t){e.id==t.current.id&&t.current.updateDetails(e)}))})),console.log(a)}},{key:"modifyDetector",value:function(e){}},{key:"createVolume",value:function(e,t,a){var n=Y.parseData(t);if(null!=n){var o=this.state.volumebuttons;X.addVolume({name:e,data:t});var i={name:e,data:t};this.volumes.push(i),o.push(r.a.createElement(lt,{detectors:this.detectors,name:e,volumes:this.volumes,modeldata:n,filelabel:a,volume:i})),this.setState({volumebuttons:o})}else alert("Geometry too complicated.")}},{key:"createSource",value:function(){var e=Object(u.a)(c.a.mark((function e(t,a,n,o,i,s,l){var u,h,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkRunnable(),this.navbar.current.showClearSetup(!0),s||this.codeeditor.current.addSourceCode(t,new E(a,n,o),i,l),u=this.state.sourcebuttons,(h=this.canvas.current.addSource(a*l,n*l,o*l,i)).id=+we.id,fe.chunks.push({id:h.id,code:'\\Source{\n\tname: "'+t+'";\n\tposition['+he.convertLength(l)+"]: "+a+", "+n+", "+o+';\n\tmaterial: "'+i+'";\n}\n'}),h.name=t,h.units[0]=l,this.sources.push(h),d=r.a.createRef(),u.push(r.a.createElement(Be,{ref:d,codeeditor:this.codeeditor,name:t,removebutton:this.removeSource,id:we.id,detector:h,key:++we.id,buttons:this.state.sourcebuttons})),this.setState({sourcebuttons:u}),this.canvas.current.source_buttons.push(d),be.log(1,"Created source"),this.checkRunnable(),e.abrupt("return",[h,we.id]);case 17:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r,o,i,s){return e.apply(this,arguments)}}()},{key:"createGun",value:function(){var e=Object(u.a)(c.a.mark((function e(t,a,n,o,i,s,l,u,h,d,m){var p,f,g;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkRunnable(),this.navbar.current.showClearSetup(!0),h||this.codeeditor.current.addGunCode(t,new E(a,n,o),new E(i,s,l),u,d,m),p=this.state.gunbuttons,(f=this.canvas.current.addGun(a*d,n*d,o*d,i,s,l,u*m)).id=+we.id,f.name=t,f.units[0]=d,f.units[1]=m,fe.addGunCode(f.id,t,new E(a,n,o),new E(i,s,l),u,d,m),this.guns.push(f),g=r.a.createRef(),p.push(r.a.createElement(Re,{ref:g,codeeditor:this.codeeditor,name:t,removebutton:this.removeGun,id:we.id,detector:f,key:++we.id,buttons:this.state.gunbuttons})),this.setState({gunbuttons:p}),this.canvas.current.gun_buttons.push(g),be.log(1,"Created gun"),this.checkRunnable(),e.abrupt("return",[f,we.id]);case 18:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r,o,i,s,l,c,u,h){return e.apply(this,arguments)}}()},{key:"createDetector",value:function(){var e=Object(u.a)(c.a.mark((function e(t,a,n,o,i,s,l,u,h,d,m,p,f,g,v,b,y,x){var w,k,C,S=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.navbar.current.showClearSetup(!0),w=this.state.buttons,v||this.codeeditor.current.addDetectorCode(0,t,new E(a,n,o),new E(i,s,l),new E(u,h,d),m,p,b,y,x),k=function(e){e.id=+we.id,e.geometry=p,fe.addDetectorCode(e.id,t,new E(a,n,o),new E(i,s,l),new E(u,h,d),m,p,b,y,x),e.name=t,e.model.color=g,e.units[0]=b,e.units[1]=y,e.units[2]=x,S.detectors.push(e);var c=r.a.createRef();w.push(r.a.createElement(we,{createvolume:S.createVolume,ref:c,volumes:S.volumes,canvas:S.canvas,codeeditor:S.codeeditor,name:t,removebutton:S.removeDetector,id:we.id,detector:e,key:++we.id,buttons:S.state.buttons})),S.canvas.current.detector_buttons.push(c),S.setState({buttons:w})},C=null,"stl"!=p){e.next=10;break}this.createVolume(t+"Volume",f,t+"Volume"),this.createDetector(t,a,n,o,i,s,l,u,h,d,m,t+"Volume",f,g,v,b,y,x),e.next=14;break;case 10:return e.next=12,this.canvas.current.addDetector(a*b,n*b,o*b,i*y,s*y,l*y,u*x,h*x,d*x,m,p,this.volumes);case 12:C=e.sent,k(C);case 14:return be.log(1,"Created detector"),this.checkRunnable(),e.abrupt("return",[C,we.id]);case 17:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r,o,i,s,l,c,u,h,d,m,p,f,g,v,b){return e.apply(this,arguments)}}()},{key:"clearSetup",value:function(){fe.chunks=[],this.codeeditor.current.updateText(" "),this.codeeditor.current.text="",this.setState({buttons:[],gunbuttons:[],sourcebuttons:[]}),this.canvas.current.clearSetup(),P.active_id=-1,this.detectors=[],this.sources=[],this.guns=[],this.state.buttons=[],this.state.gunbuttons=[],this.state.sourcebuttons=[],this.canvas.current.detector_buttons=[],this.canvas.current.source_buttons=[],this.canvas.current.gun_buttons=[],this.clearRun(),this.checkRunnable(),be.log(1,"Cleared setup")}},{key:"removeVolumes",value:function(){this.volumes=[],this.setState({volumebuttons:[]}),X.removeAll()}},{key:"removeSource",value:function(e,t){0==this.sources.length&&0==this.guns.length&&0==this.detectors.length&&this.navbar.current.showClearSetup(!1),this.canvas.current.removeSource(e),this.codeeditor.current.updateText(fe.removeChunk(e.id));for(var a=0;a<this.state.sourcebuttons.length;a++)if(this.state.sourcebuttons[a].key-1==t){var n=this.state.sourcebuttons;return n.splice(a,1),this.sources.splice(a,1),this.canvas.current.source_buttons.splice(a,1),this.setState({sourcebuttons:n}),be.log(1,"Removed source"),void this.checkRunnable()}}},{key:"removeGun",value:function(e,t){0==this.sources.length&&0==this.guns.length&&0==this.detectors.length&&this.navbar.current.showClearSetup(!1),be.log(1,"Removed gun"),this.canvas.current.removeGun(e),this.codeeditor.current.updateText(fe.removeChunk(e.id));for(var a=0;a<this.state.gunbuttons.length;a++)if(this.state.gunbuttons[a].key-1==t){var n=this.state.gunbuttons;return n.splice(a,1),this.guns.splice(a,1),this.canvas.current.gun_buttons.splice(a,1),this.setState({gunbuttons:n}),void this.checkRunnable()}}},{key:"removeDetector",value:function(e,t){0==this.sources.length&&0==this.guns.length&&0==this.detectors.length&&this.navbar.current.showClearSetup(!1),P.active_id=-1,this.canvas.current.removeDetector(e),this.codeeditor.current.updateText(fe.removeChunk(e.id));for(var a=0;a<this.state.buttons.length;a++)if(this.state.buttons[a].key-1==t){var n=this.state.buttons;return n.splice(a,1),this.canvas.current.detector_buttons.splice(a,1),this.detectors.splice(a,1),this.setState({buttons:n}),be.log(1,"Removed detector"),void this.checkRunnable()}}},{key:"setShowTracks",value:function(e){this.canvas.current.setShowTracks(!e)}},{key:"setShowParticles",value:function(e){this.canvas.current.drawParticles=!e}},{key:"setShowAxes",value:function(e){this.canvas.current.setShowAxes(!e)}},{key:"setShowGrid",value:function(e){this.canvas.current.drawGrid=!e}},{key:"load",value:function(){this.loadfile.current.click()}},{key:"saveOnline",value:function(e){gt.saveonline(this.codeeditor.current.state.text,this.volumes,e)}},{key:"updateProject",value:function(){var e=Et.get("projectid");gt.update(e,this.codeeditor.current.state.text,this.volumes)}},{key:"save",value:function(e){gt.save(this.codeeditor.current.state.text,this.volumes,e)}},{key:"componentDidMount",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t,a,n,r,o,i,s=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return se.get(""),e.next=3,ce.init();case 3:fe.init(this.volumeselect.current,this.popup.current.showDialog),me.init(this.errordialog.current),t=0;case 6:if(void 0!=t.length){e.next=15;break}return e.next=9,se.get("geometryAPI/get",{"auth-token":window.sessionStorage.getItem("auth")});case 9:return a=e.sent,e.next=12,a.json();case 12:t=e.sent,e.next=6;break;case 15:for(n=0;n<t.length;n++){for(r="",o=0;o<t[n].data.data.length;o++)r+=String.fromCharCode(t[n].data.data[o]);this.createVolume(t[n].name,r,"")}if(this.createDetector("Cube",0,0,0,0,0,0,10,10,10,"Pb","cube",null,new E(.5,.5,.5),!1,1,1,1),X.init(this.codeeditor.current),this.createSource("GPS",0,0,0,"Co60",!1,1),null==(i=Et.get("projectid"))){e.next=23;break}return e.next=23,gt.loadonline(i).then((function(e){if("Created at radsim.inf.elte.hu"!=e[1][0].content)return s.errordialog.current.setContent("Invalid project file selected."),void s.errordialog.current.showDialog();s.removeVolumes(),s.codeeditor.current.updateText(e[1][1].content+"");for(var t=2;t<e[1].length;t++)s.createVolume(e[1][t].name.split("/")[1].split(".")[0]+"",e[1][t].content+"",e[1][t].name+"");s.codeeditor.current.run(),alert(e[0]),s.navbar.current.setProjectName(e[0])}));case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"showSaveDialog",value:function(){this.confirmdialog.current.showDialog()}},{key:"render",value:function(){var e=this,t=this.state.buttons.map((function(e){return r.a.createElement("div",{style:{"z-index":"3",color:"black"}}," ",e," ")})),a=this.state.gunbuttons.map((function(e){return r.a.createElement("div",null," ",e," ")})),n=this.state.sourcebuttons.map((function(e){return r.a.createElement("div",null," ",e," ")})),o=this.state.volumebuttons.map((function(e){return r.a.createElement("div",{style:{"z-index":"3",color:"black"}}," ",e," ")}));return r.a.createElement("div",null,r.a.createElement(bt,{ref:this.errordialog,title:"ERROR",content:"Choose a zip file."}),r.a.createElement("input",{ref:this.loadfile,style:{display:"none"},type:"file",onChange:function(t){var a=new FileReader;a.onload=Object(u.a)(c.a.mark((function t(){var n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.result,t.next=3,gt.load(n).then((function(t){if("Created at radsim.inf.elte.hu"!=t[0].content)return e.errordialog.current.setContent("Invalid project file selected."),void e.errordialog.current.showDialog();e.removeVolumes(),e.codeeditor.current.updateText(t[1].content+"");for(var a=2;a<t.length;a++)e.createVolume(t[a].name.split("/")[1].split(".")[0]+"",t[a].content+"",t[a].name+"");e.codeeditor.current.run()}));case 3:case"end":return t.stop()}}),t)}))),"zip"==t.target.files[0].name.split(".")[t.target.files[0].name.split(".").length-1]?(a.readAsBinaryString(t.target.files[0]),t.target.value=null):e.errordialog.current.showDialog()}}),r.a.createElement(ht,{ref:this.volumeselect,createbutton:this.createVolume}),r.a.createElement(Xe,{ref:this.volumedialog,createbutton:this.createVolume}),r.a.createElement(ct,{ref:this.popup}),r.a.createElement(pt,{ref:this.graphdialog}),r.a.createElement(yt,{saveonline:this.saveOnline,ref:this.confirmdialog}),r.a.createElement(Q.a.Container,{id:"left-tabs-example",defaultActiveKey:"first",activeKey:this.state.page},r.a.createElement(J.a,{sm:3},r.a.createElement(Z.a,Object(s.a)({variant:"pills",className:"flex-column"},"className","page"),r.a.createElement(Z.a.Item,null,r.a.createElement(Z.a.Link,{eventKey:"first",onClick:function(){e.setState({page:"first"})}},"simulation")),r.a.createElement(Z.a.Item,null,r.a.createElement(Z.a.Link,{eventKey:"second",disabled:this.state.spectrum,onClick:function(){e.setState({page:"second"})}},"spectrum")))),r.a.createElement(Q.a.Content,null,r.a.createElement(Q.a.Pane,{eventKey:"first",style:{overflow:"hidden"}},r.a.createElement(W,{ref:this.canvas,style:{overflow:"hidden"},buttons:this.state.buttons}),r.a.createElement(rt,{save:this.save,ref:this.codeeditor,createGun:this.createGun,clearSetup:this.clearSetup,createSource:this.createSource,createDetector:this.createDetector,canvas:this.canvas}),r.a.createElement(Qe,{run:this.runSim,save:this.save,load:this.load,saveonline:this.showSaveDialog,updateproject:this.updateProject,ref:this.navbar,canvas:this.canvas,projectname:this.state.projectName,className:"navbar",volumes:this.volumes,runspectroscopy:this.runSpectroscopy,createbutton:this.createDetector,creategunbutton:this.createGun,createsourcebutton:this.createSource,createvolume:this.createVolume,setshowtracks:this.setShowTracks,setshowparticles:this.setShowParticles,setshowaxes:this.setShowAxes,setshowgrid:this.setShowGrid,clearrun:this.clearRun,clearSetup:this.clearSetup,detectors:this.detectors,buttons:this.state.buttons}),r.a.createElement("div",{className:"buttonbackground"}),r.a.createElement($.a,{ref:this.accordion,defaultActiveKey:"0",className:"accordion",style:{maxHeight:window.innerHeight-50,height:window.innerHeight-50,"overflow-y":"scroll"}},r.a.createElement("div",{style:{color:"white","text-align":"center","background-color":"gray",border:"1px solid white"}},"Volumes"),o,r.a.createElement("div",{style:{color:"white","text-align":"center","background-color":"gray",border:"1px solid white"}},"Detectors"),t,r.a.createElement("div",{style:{color:"white","text-align":"center","background-color":"gray",border:"1px solid white"}},"Sources"),n,r.a.createElement("div",{style:{color:"white","text-align":"center","background-color":"gray",border:"1px solid white"}},"Guns"),a)),r.a.createElement(Q.a.Pane,{eventKey:"second"},r.a.createElement(et,{ref:this.spectrum})))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(xt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[371,1,2]]]);
//# sourceMappingURL=main.9c6e8b57.chunk.js.map